!function(){"use strict";class e{static calcDistance(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}static getDirectionAToB(e,t,a=!0){let i=e.transform.position.clone(),s=t.transform.position.clone(),n=new Laya.Vector3(0,0,0);return Laya.Vector3.subtract(s,i,n),a&&Laya.Vector3.normalize(n,n),n}static fixPosY(e,t=1334){return e*Laya.stage.displayHeight/t}static findNodeByName(e,t){let a=null,i=e=>{for(let s=0;s<e.numChildren;s++){if(e.getChildAt(s).name==t)return void(a=e.getChildAt(s));i(e.getChildAt(s))}};return i(e),a}static TmoveTo(e,t,a,i,s){var n=e.transform.position;Laya.Tween.to(e.transform.position,{x:a.x,y:a.y,z:a.z,update:new Laya.Handler(this,()=>{e.transform.position=n})},t,s||Laya.Ease.cubicOut,Laya.Handler.create(this,()=>{i&&i()}))}}class t{}t.UnityPath="LayaScene_MyScene/Conventional/";class a extends Laya.Script{constructor(){super(),this.myOwner=null,this._ani=null,this.weaponNode=null,this.enemyNode=null,this.isPlayer=!0,this.isHited=!1,this.walkSpeed=.005,this.myId=0,this.haveWeapon=!1,this.aniSpeed=1,this.hp=3,this.isDied=!1}onAwake(){this.myOwner=this.owner,this._ani=this.owner.getComponent(Laya.Animator),this.playIdle(),this.weaponNode=e.findNodeByName(this.myOwner,"Dummy001")}initData(e,t){this.myId=e,this.isPlayer=t}playIdle(){this._ani.speed=1,this._ani.crossFade("idle",.05)}playWalk(){this._ani.speed=1,this._ani.crossFade("walk",.05)}playDied(){this._ani.speed=1,this._ani.crossFade("die",.05)}addWeapon(e){this.weaponNode.addChild(e),e.transform.localPosition=new Laya.Vector3(0,0,0),this.haveWeapon=!0}removeWeapon(){this.weaponNode.destroyChildren()}goToFight(e){this.enemyNode=e,this.playWalk()}onUpdate(){if(this.enemyNode&&this.enemyNode.numChildren>0&&!this.isHited&&!this.isDied){let t=this.myOwner.transform.position.clone(),a=99999,i=null;for(let e=0;e<this.enemyNode.numChildren;e++){let s=this.enemyNode.getChildAt(e),n=Laya.Vector3.distance(t,s.transform.position.clone());n<a&&(a=n,i=s)}let s=e.getDirectionAToB(this.myOwner,i);s=new Laya.Vector3(s.x*this.walkSpeed,s.y*this.walkSpeed,s.z*this.walkSpeed);let n=new Laya.Vector3(0,0,0);Laya.Vector3.add(t,s,n),this.myOwner.transform.position=n}}onLateUpdate(){this.weaponNode&&this.enemyNode&&this.enemyNode.numChildren>0&&!this.isHited&&!this.isDied&&this.checkIsHitEnemy()}checkIsHitEnemy(){let e=this.weaponNode.getChildAt(0);if(e&&null!=e&&null!=e&&!this.isDied)for(let t=0;t<e.numChildren;t++){let i=e.getChildAt(t),s=i.transform.position.clone();s.y=1.4;for(let e=0;e<this.enemyNode.numChildren;e++){let t=this.enemyNode.getChildAt(e),n=t.transform.position.clone();if(n.y=1.4,Laya.Vector3.distance(s,n)<=.7){return void t.getComponent(a).hitBack(i)}}}}hitBack(t){if(this.isDied)return;if(this.hp-=1,this.hp<=0)return this.isDied=!0,void Laya.timer.once(800,this,()=>{this.playDied(),Laya.timer.once(1e3,this,()=>{this.owner.destroy()})});this.isHited=!0;let a=t.transform.position.clone(),i=this.myOwner.transform.position.clone(),s=new Laya.Vector3(0,0,0);Laya.Vector3.subtract(i,a,s),Laya.Vector3.normalize(s,s),s=new Laya.Vector3(1*s.x,0,1*s.z);let n=this.myOwner.transform.position.clone();Laya.Vector3.add(n,s,n),e.TmoveTo(this.myOwner,200,n,()=>{this.isHited=!1})}}const i=.03;class s{constructor(){this._playerNode=new Laya.Sprite3D,this._aiNode=new Laya.Sprite3D,s.Share=this,Laya.Scene.open("MyScenes/LoadingUI.scene")}loadAtlas(){}initScene(){Laya.Scene3D.load(t.UnityPath+"MyScene.ls",Laya.Handler.create(this,this.onLoadScene))}onLoadScene(e){this._scene=Laya.stage.addChild(e),Laya.stage.setChildIndex(this._scene,0),this._scene.addChild(this._playerNode),this._scene.addChild(this._aiNode),this._camera=this._scene.getChildByName("Main Camera"),this._light=this._scene.getChildByName("Directional Light"),this._plane=this._scene.getChildByName("Plane"),this.createPlayer(),this.createAi()}createPlayer(){let e=Laya.loader.getRes(t.UnityPath+"Hero_1.lh"),i=1;for(let t=0;t<3;t++){let s=Laya.Sprite3D.instantiate(e,this._playerNode,!1,new Laya.Vector3(0,.5,0));s.addComponent(a).initData(t,!0),s.transform.translate(new Laya.Vector3(i,.5,0),!1),i-=1}}createAi(){this._aiNode.transform.position=new Laya.Vector3(0,0,4);let e=Laya.loader.getRes(t.UnityPath+"Hero_1.lh"),i=1;for(let s=0;s<3;s++){let n=Laya.Sprite3D.instantiate(e,this._aiNode,!0,new Laya.Vector3(0,.5,0)),o=n.addComponent(a);o.initData(s,!1),n.transform.localPosition.x=i,n.transform.localPosition.y=.5,n.transform.localPosition.z=0,n.transform.rotate(new Laya.Vector3(0,180,0),!0,!1),i-=1;let r=Laya.loader.getRes(t.UnityPath+"aiWeapon.lh"),h=Laya.Sprite3D.instantiate(r,null,!0,new Laya.Vector3(0,0,0));o.addWeapon(h)}}createLine3D(e){let s=new Laya.Sprite3D,n=Laya.loader.getRes(t.UnityPath+"line.lh"),o=new Laya.Vector3(0,0,0);for(let t=0;t<e.length;t++)if(0==t){let e=Laya.Sprite3D.instantiate(n,s,!1,new Laya.Vector3(0,0,0));e.transform.position=new Laya.Vector3(0,0,0),o=e.transform.position.clone()}else{let a=new Laya.Vector3(-e[t-1].x,0,-e[t-1].y),r=new Laya.Vector3(-e[t].x,0,-e[t].y),h=s.getChildAt(s.numChildren-1).transform.position.clone(),l=Laya.Vector3.distance(a,r);for(let e=0;e<Math.floor(l/10);e++){let t=Laya.Sprite3D.instantiate(n,s,!1,new Laya.Vector3(0,0,0)),l=new Laya.Vector3(0,0,0);Laya.Vector3.subtract(r,a,l),Laya.Vector3.normalize(l,l);let c=i*(e+1);l=new Laya.Vector3(l.x*c,l.y*c,l.z*c);let d=new Laya.Vector3(0,0,0);Laya.Vector3.add(h,l,d),t.transform.position=d,t.transform.position.z<o.z&&(o=t.transform.position.clone())}}for(let e=0;e<s.numChildren;e++){let t=s.getChildAt(e),a=new Laya.Vector3(0,0,0);Laya.Vector3.subtract(t.transform.position,o,a),t.transform.position=a}for(let e=0;e<this._playerNode.numChildren;e++){let t=this._playerNode.getChildAt(e).getComponent(a);if(!t.haveWeapon){t.addWeapon(s);break}}this.checkWeaponed()&&this.readyGo()}checkWeaponed(){let e=!0;for(let t=0;t<this._playerNode.numChildren;t++){this._playerNode.getChildAt(t).getComponent(a).haveWeapon||(e=!1)}return e}readyGo(){for(let e=0;e<this._playerNode.numChildren;e++){this._playerNode.getChildAt(e).getComponent(a).goToFight(this._aiNode)}for(let e=0;e<this._aiNode.numChildren;e++){this._aiNode.getChildAt(e).getComponent(a).goToFight(this._playerNode)}}}s.WEAPON_LENGTH=100;class n extends Laya.Scene{constructor(){super(),this.touchPanel=this.touchPanel,this.touchNode=this.touchNode,this.drawSp=this.drawSp,this.touchStarted=!1,this.startPos=null,this.lineArr=[],this.lineArrVec2=[]}onOpened(e){this.initData()}onClosed(){}initData(){this.touchPanel.y=e.fixPosY(this.touchPanel.y),this.touchNode.on(Laya.Event.MOUSE_DOWN,this,this.touchStart),this.touchNode.on(Laya.Event.MOUSE_MOVE,this,this.touchMove),this.touchNode.on(Laya.Event.MOUSE_UP,this,this.touchEnd)}touchStart(e){this.safeArea(new Laya.Vector2(e.stageX,e.stageY))&&(this.touchStarted=!0,this.startPos=new Laya.Vector2(e.stageX,e.stageY),this.lineArr=[],this.lineArr.push(this.startPos.x),this.lineArr.push(this.startPos.y),this.lineArrVec2=[],this.lineArrVec2.push(this.startPos))}touchMove(t){if(!this.safeArea(new Laya.Vector2(t.stageX,t.stageY))||!this.touchStarted)return;let a=new Laya.Vector2(t.stageX,t.stageY);e.calcDistance(this.startPos,a)>=10&&this.lineArrVec2.length<s.WEAPON_LENGTH&&(this.lineArr.push(a.x),this.lineArr.push(a.y),this.lineArrVec2.push(a),this.startPos=a,this.drawLine())}touchEnd(e){this.touchStarted&&(this.touchStarted=!1,this.drawSp.graphics.clear(),s.Share.createLine3D(this.lineArrVec2))}drawLine(){this.drawSp.graphics.clear(),this.drawSp.graphics.drawLines(0,0,this.lineArr,"#ff0000",3)}safeArea(e){let t=this.touchPanel.x-this.touchPanel.width/2,a=this.touchPanel.x+this.touchPanel.width/2,i=this.touchPanel.y-this.touchPanel.height/2,s=this.touchPanel.y+this.touchPanel.height/2;return!(e.x<t||e.x>a||e.y<i||e.y>s)}}class o extends Laya.Scene{constructor(){super(),this.perNum=this.perNum}onOpened(e){this.loadRes()}onClosed(){}loadRes(){var e=[t.UnityPath+"line.lh",t.UnityPath+"Hero_1.lh",t.UnityPath+"aiWeapon.lh"];Laya.loader.create(e,Laya.Handler.create(this,this.onComplete),Laya.Handler.create(this,this.onProgress))}onComplete(){s.Share.initScene(),Laya.timer.once(1e3,this,()=>{Laya.Scene.open("MyScenes/GameUI.scene")})}onProgress(e){this.perNum.text=Math.floor(100*e)+"%"}}class r{constructor(){}static init(){var e=Laya.ClassUtils.regClass;e("View/GameUI.ts",n),e("View/LoadingUI.ts",o)}}r.width=750,r.height=1334,r.scaleMode="fixedwidth",r.screenMode="vertical",r.alignV="middle",r.alignH="center",r.startScene="MyScenes/GameUI.scene",r.sceneRoot="",r.debug=!1,r.stat=!0,r.physicsDebug=!1,r.exportSceneToJson=!0,r.init();new class{constructor(){window.Laya3D?Laya3D.init(r.width,r.height):Laya.init(r.width,r.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=r.scaleMode,Laya.stage.screenMode=r.screenMode,Laya.stage.alignV=r.alignV,Laya.stage.alignH=r.alignH,Laya.URL.exportSceneToJson=r.exportSceneToJson,(r.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),r.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),r.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){new s}}}();