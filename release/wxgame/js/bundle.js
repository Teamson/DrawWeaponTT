!function(){"use strict";class e{static LoginWx(e){if(!Laya.Browser.onWeiXin)return;let t=Laya.Browser.window.wx.getLaunchOptionsSync();Laya.Browser.window.wx.login({success(a){a.code&&(console.log("res.code:",a.code),e&&e(a.code,t.query))}})}static checkScope(e){Laya.Browser.onWeiXin&&Laya.Browser.window.wx.getSetting({success:t=>{t.authSetting["scope.userInfo"]?console.log("已经授权"):(console.log("没有授权"),this.createScope(e))}})}static createScope(e){this.scopeBtn=Laya.Browser.window.wx.createUserInfoButton({type:"text",text:"",style:{left:e.x,top:e.y,width:e.width,height:e.height,lineHeight:40,backgroundColor:"#ffffff",color:"#ffffff",textAlign:"center",fontSize:16,borderRadius:0}}),this.scopeBtn.onTap(e=>{"getUserInfo:ok"==e.errMsg?(this.scopeBtn.destroy(),this.scopeBtn=null):"getUserInfo:fail auth deny"==e.errMsg&&(this.scopeBtn.destroy(),this.scopeBtn=null)})}static GetLaunchParam(e){Laya.Browser.onWeiXin&&(this.OnShowFun=e,e(this.GetLaunchPassVar()),Laya.Browser.window.wx.onShow(e=>{null!=this.OnShowFun&&this.OnShowFun(e),console.log("wx on show")}))}static GetLaunchPassVar(){return Laya.Browser.onWeiXin?Laya.Browser.window.wx.getLaunchOptionsSync():null}static WxOnHide(e){Laya.Browser.onWeiXin&&Laya.Browser.window.wx.onHide(e)}static httpRequest(e,t,a="get",i){var s=new Laya.HttpRequest;s.http.timeout=5e3,s.once(Laya.Event.COMPLETE,this,i),s.once(Laya.Event.ERROR,this,this.httpRequest,[e,t,a,i]),"get"==a?s.send(e+"?"+t,"",a,"text"):"post"==a&&s.send(e,JSON.stringify(t),a,"text")}static DoVibrate(e=!0){Laya.Browser.onWeiXin&&this.isVibrate&&(e?Laya.Browser.window.wx.vibrateShort():Laya.Browser.window.wx.vibrateLong())}static OpenAlert(e,t=2e3,a=!1){Laya.Browser.onWeiXin&&Laya.Browser.window.wx.showToast({title:e,duration:t,mask:!1,icon:a?"success":"none"})}static NavigateApp(e,t,a,i,s){if(Laya.Browser.onWeiXin){Laya.Browser.window.wx.navigateToMiniProgram({appId:e,path:t,success(e){console.log("打开成功"),s()},fail(e){console.log("打开失败"),i()}})}}static preViewImage(e){Laya.Browser.onWeiXin&&Laya.Browser.window.wx.previewImage({current:e,urls:[e]})}static aldEvent(e){}static ttEvent(e){Laya.Browser.onWeiXin&&Laya.Browser.window.tt.reportAnalytics(e,{})}static createMoreGamesButton(e,t,a,i){let s=Laya.Browser.clientWidth/Laya.stage.displayWidth,n=Laya.Browser.clientHeight/Laya.stage.displayHeight;e*=s,t*=n,a*=s,i*=n,Laya.Browser.window.tt.createMoreGamesButton({type:"text",image:"",style:{left:e,top:t,width:a,height:i,lineHeight:0,backgroundColor:"#ffffff",textColor:"#000000",textAlign:"center",fontSize:16,borderRadius:4,borderWidth:1,borderColor:"#000000"},appLaunchOptions:[{appId:"tt49703fcdd64ab8f4"},{appId:"ttcbf5bd4854cff760"},{appId:"tt2def5b52b2c5a4ee"},{appId:"tt3eb2480fa19877fb"},{appId:"tt3fc3497ea0e924bc"},{appId:"ttccd7ba6a53fd8cfe"}],onNavigateToMiniGameBox(e){console.log("跳转到小游戏盒子",e)}}).onTap(()=>{console.log("点击更多游戏")})}static showMoreGamesModal(){if(Laya.Browser.onWeiXin){"ios"!==Laya.Browser.window.tt.getSystemInfoSync().platform&&Laya.Browser.window.tt.showMoreGamesModal({appLaunchOptions:[{appId:"tt49703fcdd64ab8f4"},{appId:"ttcbf5bd4854cff760"},{appId:"tt2def5b52b2c5a4ee"},{appId:"tt3eb2480fa19877fb"},{appId:"tt3fc3497ea0e924bc"},{appId:"ttccd7ba6a53fd8cfe"}],success(e){console.log("success",e.errMsg)},fail(e){console.log("fail",e.errMsg)}})}}static getIsIos(){if(!Laya.Browser.onWeiXin)return!1;return"ios"===Laya.Browser.window.tt.getSystemInfoSync().platform}}e.UnityPath="LayaScene_MyScene/Conventional/",e.version="1.0.8",e.isVibrate=!0,e.isMusic=!0,e.OnShowFun=null,e.scopeBtn=null,e.shareCallback=null,e.front_share_number=0,e.gotOfflineBounes=!1,e.configData=null,e.shareTime=0,e.firstShare=!0,e.launchGameUI=!1,e.firstStartGame=!1,e.showFinishWudian=0,e.ExtractUIGapGrade=0;class t{static calcDistance(e,t){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}static getDirectionAToB(e,t,a=!0){let i=e.transform.position.clone(),s=t.transform.position.clone(),n=new Laya.Vector3(0,0,0);return Laya.Vector3.subtract(s,i,n),a&&Laya.Vector3.normalize(n,n),n}static fixPosY(e,t=1334){return e*Laya.stage.displayHeight/t}static findNodeByName(e,t){let a=null,i=e=>{for(let s=0;s<e.numChildren;s++){if(e.getChildAt(s).name==t)return void(a=e.getChildAt(s));i(e.getChildAt(s))}};return i(e),a}static TmoveTo(e,t,a,i,s){let n=new Laya.Tween;var r=e.transform.position;n.to(e.transform.position,{x:a.x,y:a.y,z:a.z,update:new Laya.Handler(this,()=>{e.transform.position=r})},t,s||Laya.Ease.cubicOut,Laya.Handler.create(this,()=>{i&&i()}))}static RotateTo(e,t,a,i){var s=e.transform.localRotationEuler;Laya.Tween.to(e.transform.localRotationEuler,{x:a.x,y:a.y,z:a.z,update:new Laya.Handler(this,function(){e&&(e.transform.localRotationEuler=s)})},t,Laya.Ease.cubicOut,Laya.Handler.create(this,function(){i&&i()}))}static tMove2D(e,t,a,i,s){Laya.Tween.to(e,{x:t,y:a},i,null,new Laya.Handler(this,()=>{s&&s()}))}static updateNumber(e,t,a,i=!0,s,n){let r=e*t,o=Math.floor((r-e)/60);o=o<=0?1:o;let h=()=>{s?((e+=o)>=r&&(e=r,n&&n(),Laya.timer.clear(this,h)),i?a.text=e.toString():a.value=e.toString()):((r-=o)<=e&&(r=e,n&&n(),Laya.timer.clear(this,h)),i?a.text=r.toString():a.value=r.toString())};Laya.timer.frameLoop(1,this,h)}static loadJson(e,t){Laya.loader.load(e,Laya.Handler.create(this,t),null,Laya.Loader.JSON)}static objectShake(e,t=1,a=.7){var i=t,s=1,n=e.transform.localPosition.clone();Laya.timer.frameLoop(1,this,function updateShake(){if(i>0){var t=new Laya.Vector3;Laya.Vector3.scale((r=Math.random()>.5?Math.random():-Math.random(),o=Math.random()>.5?Math.random():-Math.random(),new Laya.Vector3(r,o,0)),a,t),Laya.Vector3.add(n,t,t),e.transform.localPosition=t,i-=.02*s}else i=0,e.transform.localPosition=n,Laya.timer.clear(this,updateShake);var r,o})}static getRandomItemInArr(e){return e[Math.floor(Math.random()*e.length)]}static shuffleArr(e){let t=e.length;for(;t;){let a=Math.floor(Math.random()*t--);[e[a],e[t]]=[e[t],e[a]]}return e}static GetRandom(e,t,a=!0){let i=t-e+1,s=Math.random()*i;return s+=e,a?Math.floor(s):s}static coinCollectAnim(e,t,a,i=10,s){let n=i;for(var r=0;r<i;r++){let i=Laya.Pool.getItemByClass("coin",Laya.Image);i.skin="mainUI/sy-jb.png",i.x=e.x,i.y=e.y,a.addChild(i);let r=300+100*Math.random()-50;Laya.Tween.to(i,{x:i.x+250*Math.random()-125,y:i.y+250*Math.random()-125},r),Laya.timer.once(r+50,this,function(){Laya.Tween.to(i,{x:t.x,y:t.y},400,null,new Laya.Handler(this,function(){a.removeChild(i),Laya.Pool.recover("coin",i),0==--n&&s&&s()}))})}}static scaleLoop(e,t,a){Laya.Tween.to(e,{scaleX:t,scaleY:t},a,null,new Laya.Handler(this,()=>{Laya.Tween.to(e,{scaleX:1,scaleY:1},a,null,new Laya.Handler(this,()=>{this.scaleLoop(e,t,a)}))}))}static rotateLoop(e,t,a){Laya.Tween.to(e,{rotation:t},a,null,new Laya.Handler(this,()=>{Laya.Tween.to(e,{rotation:-t},2*a,null,new Laya.Handler(this,()=>{Laya.Tween.to(e,{rotation:0},a,null,new Laya.Handler(this,()=>{this.rotateLoop(e,t,a)}))}))}))}static visibleDelay(e,t){e.visible=!1,Laya.timer.once(t,this,()=>{e.visible=!0})}static pointInPolygon(e,t){for(var a=e.x,i=e.y,s=!1,n=0,r=t.length-1;n<t.length;r=n++){var o=t[n].x,h=t[n].y,l=t[r].x,d=t[r].y;h>i!=d>i&&a<(l-o)*(i-h)/(d-h)+o&&(s=!s)}return s}}class a{constructor(){this.grade=1,this.gradeIndex=0,this.power=10,this.playerCountLv=1,this.playerPowerLv=1,this.playerOfflineLv=1,this.coin=0,this.playerId=0,this.playerArr=[],this.unlockSkinCount=0,this.exitTime=0}}class i{static getPlayerData(){if(localStorage.getItem("playerData"))null==this._playerData&&(this._playerData=JSON.parse(localStorage.getItem("playerData")));else{this._playerData=new a;for(let e=0;e<27;e++)0==e?this._playerData.playerArr.push(0):this._playerData.playerArr.push(-1);localStorage.setItem("playerData",JSON.stringify(this._playerData))}return this._playerData}static setPlayerData(){localStorage.setItem("playerData",JSON.stringify(this._playerData))}static getPlayerYet(){let e=[];for(let t=0;t<this._playerData.playerArr.length;t++)this._playerData.playerArr[t]<0&&e.push(t);return e}static getCoinSkins(){let e=[].concat(this.skinArr1),t=[];for(let a=0;a<e.length;a++)this._playerData.playerArr[a]<0&&t.push(e[a]);return t}static getVideoSkins(){let e=[].concat(this.skinArr2),t=[];for(let a=0;a<e.length;a++)this._playerData.playerArr[a+9]<0&&t.push(e[a]);return t}static getFreeSkins(){let e=[].concat(this.skinArr1,this.skinArr2,this.skinArr3);e=t.shuffleArr(e);let a=[];for(let t=0;t<e.length;t++){let i=this.getPlayerArrIndexByValue(e[t]);if(this._playerData.playerArr[i]<0&&(a.push(e[t]),a.length>=1))break}return a}static getBoxSkins(){let e=[].concat(this.skinArr3),t=[];for(let a=0;a<e.length;a++)this._playerData.playerArr[a+18]<0&&t.push(e[a]);return t}static changeCoin(e){this._playerData.coin+=e,this.setPlayerData()}static getPlayerSkin(e,t){this._playerData.playerArr[e]=t,this._playerData.playerId=t,this.setPlayerData()}static getPlayerCountLv(){return this._playerData.playerCountLv}static upgradePlayerCountLv(){this._playerData.playerCountLv>=5||(this._playerData.playerCountLv+=1,this.setPlayerData())}static getPlayerCount(){return this._playerData.playerCountLv}static getCountLvMax(){return this._playerData.playerCountLv>=5}static getPlayerPowerLv(){return this._playerData.playerPowerLv}static upgradePlayerPowerLv(){this._playerData.playerPowerLv>=35||(this._playerData.playerPowerLv+=1,this.setPlayerData())}static getPlayerPowerData(){let e={hp:125,atk:20};return e.hp=125+4*(this._playerData.playerPowerLv-1),e.atk=20+2*(this._playerData.playerPowerLv-1),e}static getPowerLvMax(){return this._playerData.playerPowerLv>=35}static getPlayerOfflineLv(){return this._playerData.playerOfflineLv}static upgradePlayerOfflineLv(){this._playerData.playerOfflineLv>=56||(this._playerData.playerOfflineLv+=1,this.setPlayerData())}static getPlayerOffline(e){return Math.floor(e*(1+.05*(this._playerData.playerOfflineLv-1)))}static getOfflineLvMax(){return this._playerData.playerOfflineLv>=56}static getNpcData(){let e={hp:100,atk:10},t=Math.floor((this._playerData.grade-1)/5)+1;return e.hp=100+10*(t-1),e.atk=10+5*(t-1),e.hp>240&&(e.hp=240),e.atk>90&&(e.atk=90),e}static getUpgradePlayerCountLvCost(){let e=100;return e=100+500*(this.getPlayerCountLv()-1)}static getUpgradePlayerPowerLvCost(){let e=50;return e=50+50*(this.getPlayerPowerLv()-1)}static getUpgradeOfflineLvCost(){let e=50;return e=50+50*(this.getPlayerOfflineLv()-1)}static getUnlockSkinCost(){return 100+100*this._playerData.unlockSkinCount}static getHeroSkinDir(e){return"heroSkins/Hero_"+(e+1)+".png"}static setExitTime(){this._playerData.exitTime=(new Date).getTime(),this.setPlayerData()}static getPlayerArrIndexByValue(e){for(let t=0;t<this.skinArr1.length;t++)if(-1!=this.skinArr1.indexOf(e))return this.skinArr1.indexOf(e);for(let t=0;t<this.skinArr2.length;t++)if(-1!=this.skinArr2.indexOf(e))return this.skinArr2.indexOf(e)+9;for(let t=0;t<this.skinArr3.length;t++)if(-1!=this.skinArr3.indexOf(e))return this.skinArr3.indexOf(e)+18;return-1}static getWeaponDataById(e){switch(e){case 0:return{name:"塔卡纳",info:"移动速度增加10%"};case 1:return{name:"超能战刃",info:"挥动速度增加30%"};case 2:return{name:"棒棒!棒球棒",info:"击退距离增加30%"};case 3:return{name:"屠龙刀",info:"攻击力增加+30%"};case 4:return{name:"隐匿匕首",info:"移动速度降低10%一击必杀"};case 5:return{name:"黑武士之剑",info:"击杀一名敌人恢复25%血量"};case 6:return{name:"雷神之锤",info:"击中时对所有敌人造成40%的伤害"};case 7:return{name:"平底锅",info:"自身受到的伤害减少30%"};case 8:return{name:"越来越有电锯",info:"挥动速度降低10%,恢复2%生命/s"}}}}i.maxPower=10,i._playerData=null,i.tempSkinId=-1,i.aiConfig=null,i.posConfig=null,i.freeSkinId=-1,i.skinArr1=[0,1,2,8,9],i.skinArr2=[3,4],i.skinArr3=[5,6,7],i.skinArr4=[8,9];class s{static get instance(){return this._instance||(this._instance=new s),this._instance}initLoading(e){var t=[{url:"res/sounds/bgm.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/castleHit1.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/castleHit2.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/castleHit3.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/die1.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/die2.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/getCoin.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/weaponHit1.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/weaponHit2.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/weaponHit3.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/weaponHit4.mp3",type:Laya.Loader.SOUND},{url:"res/sounds/weaponReady.mp3",type:Laya.Loader.SOUND}];Laya.loader.load(t,Laya.Handler.create(this,e)),Laya.SoundManager.useAudioMusic=!0,Laya.SoundManager.setMusicVolume(1)}playMusic(e,t=0,a){Laya.SoundManager.playMusic("res/sounds/"+e,t,new Laya.Handler(this,a))}stopMusic(){Laya.SoundManager.stopMusic()}playSoundEffect(e,t=1,a){Laya.SoundManager.playSound("res/sounds/"+e,t,new Laya.Handler(this,a))}}class n extends Laya.Script{constructor(){super(),this.myOwner=null,this._ani=null,this.isHited=!1,this.isDied=!1,this.hp=100}onAwake(){this.myOwner=this.owner,this._ani=this.owner.getComponent(Laya.Animator)}onDisable(){}playDied(){this._ani.speed=1,this._ani.crossFade("Take 001",.05)}hitBack(a){if(this.isDied||this.isHited)return;let i=t.GetRandom(1,3);if(s.instance.playSoundEffect("castleHit"+i+".mp3"),e.DoVibrate(),t.objectShake(this.myOwner,.2,.1),this.hp-=a,this.hp<=0)return this.isDied=!0,this.playDied(),f.Share.getCoinNum+=10,void Laya.timer.once(1e3,this,()=>{this.owner.destroy()});this.isHited=!0,Laya.timer.once(500,this,()=>{this.isHited=!1})}}class r{constructor(){this.tCount=0,r.Share=this,this.init()}init(){localStorage.getItem("powerTime")?this.tCount=parseInt(localStorage.getItem("powerTime")):localStorage.setItem("power","0"),this.calculateExitTime(),Laya.Browser.onWeiXin&&(Laya.Browser.window.wx.onShow(e=>{this.calculateExitTime()}),Laya.Browser.window.wx.onHide(e=>{localStorage.setItem("powerTime",this.tCount.toString()),localStorage.setItem("exitTime",(new Date).getTime().toString())})),Laya.timer.loop(1e3,this,this.calculateTime)}calculateExitTime(){let e=0;if(localStorage.getItem("exitTime")&&(e=(new Date).getTime()-parseInt(localStorage.getItem("exitTime"))),e<=0)return;e/=1e3;let t=Math.floor(e/600);i.getPlayerData().power+=t,i.getPlayerData().power>i.maxPower&&(i.getPlayerData().power=i.maxPower,i.setPlayerData())}calculateTime(){this.tCount<=0?i.getPlayerData().power<i.maxPower?this.tCount=600:this.tCount=0:(this.tCount--,this.tCount<=0&&i.getPlayerData().power<i.maxPower&&(i.getPlayerData().power+=1,i.setPlayerData(),this.tCount=i.getPlayerData().power<i.maxPower?600:0))}}class o extends Laya.Script{constructor(){super(),this.iconIndex=1}onEnable(){o.Share=this,this.calculateTime(),Laya.timer.loop(1e3,this,this.calculateTime),this.initData(),t.rotateLoop(this.navNode,10,200),this.navNode.on(Laya.Event.CLICK,this,()=>{e.showMoreGamesModal()}),this.navNode.visible=!e.getIsIos(),this.navNode.getChildByName("icon").skin="res/icons/icon (1).png",Laya.timer.loop(3e3,this,this.changeIcon)}changeIcon(){this.iconIndex++,this.iconIndex>17&&(this.iconIndex=1),this.navNode.getChildByName("icon").skin="res/icons/icon ("+this.iconIndex+").png"}initData(){this.coinNum.value=i.getPlayerData().coin.toString(),this.powerNum.value=i.getPlayerData().power.toString(),this.gradeNum.text=i.getPlayerData().grade.toString(),this.bar.width=(i.getPlayerData().gradeIndex+1)/4*480,this.bossPic.visible=this.bar.width>=480;let e=0==Math.floor(i.getPlayerData().grade%4)?4:Math.floor(i.getPlayerData().grade%4);for(let t=0;t<this.keyNode.numChildren;t++){this.keyNode.getChildAt(t).skin=e>t+1?"mainUI/sy-ys1.png":"mainUI/sy-ys2.png"}}onDisable(){Laya.timer.clearAll(this)}calculateTime(){let e=r.Share.tCount,t=Math.floor(e/60),a=Math.floor(e-60*t);this.powerTime.text=t.toString()+":"+a.toString(),this.powerNum.value=i.getPlayerData().power.toString(),this.powerTime.visible=i.getPlayerData().power<i.maxPower}}var h;!function(e){e.HpBar="prefab/hpBar.prefab",e.Smile="prefab/smile.prefab",e.Cry="prefab/cry.prefab"}(h||(h={}));class l{constructor(){this.init(),Laya.loader.load(this.url,Laya.Handler.create(this,this.loadComplete),Laya.Handler.create(this,this.loadProgress),Laya.Loader.PREFAB)}static instance(){return l._instance?l._instance:l._instance=new l}init(){this.url=[];for(let e in h)this.url.push(h[e])}getItem(e){let t=Laya.loader.getRes(e);return t?Laya.Pool.getItemByCreateFun(e,t.create,t):null}recoverItem(e,t){Laya.Pool.recover(e,t)}loadProgress(e){console.log("预制体资源加载中...",e)}loadComplete(){console.log("预制体资源加载完成!")}}class d extends Laya.Script{constructor(){super(),this.playerNode=null,this.playerCrl=null,this.ready=!1}onAwake(){this.myOwner=this.owner}onDisable(){}initData(e){this.playerNode=e,this.ready=!0,this.playerCrl=this.playerNode.getComponent(u)}onUpdate(){if(!this.ready)return;if(null==this.playerNode.transform||null==this.playerNode.transform)return void this.myOwner.destroy();this.myOwner.value=this.playerCrl.hp/this.playerCrl.hpMax;let e=new Laya.Vector4(0,0,0),t=this.playerNode.transform.position.clone();this.playerCrl.isPlayer?t.z-=1:t.y+=4,f.Share._camera.viewport.project(t,f.Share._camera.projectionViewMatrix,e),this.myOwner.pos(e.x/Laya.stage.clientScaleX,e.y/Laya.stage.clientScaleY)}}class c extends Laya.Script{constructor(){super(),this.playerNode=null,this.playerCrl=null,this.ready=!1}onAwake(){this.myOwner=this.owner}onDisable(){}initData(e){this.playerNode=e,this.playerCrl=this.playerNode.getComponent(u),this.ready=!0,Laya.timer.once(2e3,this,()=>{this.myOwner.destroy()})}onUpdate(){if(!this.ready)return;if(null==this.playerNode.transform||null==this.playerNode.transform)return void this.myOwner.destroy();let e=new Laya.Vector4(0,0,0),t=this.playerNode.transform.position.clone();t.y+=3.5,f.Share._camera.viewport.project(t,f.Share._camera.projectionViewMatrix,e),this.myOwner.pos(e.x/Laya.stage.clientScaleX,e.y/Laya.stage.clientScaleY)}}class y{constructor(){this.bannerUnitId=["90mc9fdgkm7dbr7i37"],this.videoUnitId="55cpk10le9d24bd43g",this.bannerAd=null,this.videoAd=null,this.videoCallback=null,this.curBannerId=0,this.showBannerCount=0,this.closeVCB=null,this.videoIsError=!1,this.videoLoaded=!1}static get instance(){return this._instance||(this._instance=new y),this._instance}initAd(){Laya.Browser.onWeiXin&&(this.initBanner(),this.initVideo())}initBanner(){let e=!1;Laya.Browser.onWeiXin&&Laya.Browser.window.wx.getSystemInfo({success:t=>{-1!=t.model.search("iPhone X")&&(e=!0)}});let t=Laya.Browser.window.wx.getSystemInfoSync();this.bannerAd=Laya.Browser.window.wx.createBannerAd({adUnitId:this.bannerUnitId[0],style:{left:0,top:0,width:100}}),this.bannerAd.onResize(e=>{this.bannerAd.style.top=t.windowHeight-e.height-10,this.bannerAd.style.left=t.windowWidth/2-e.width/2}),this.bannerAd.onError(e=>{})}hideBanner(){Laya.Browser.onWeiXin&&this.bannerAd.hide()}showBanner(){Laya.Browser.onWeiXin&&(this.showBannerCount++,this.bannerAd.show())}destroyBanner(){Laya.Browser.onWeiXin&&this.bannerAd&&(this.bannerAd.destroy(),this.bannerAd=null)}initVideo(){this.videoAd||(this.videoAd=window.tt.createRewardedVideoAd({adUnitId:this.videoUnitId})),this.loadVideo(),this.videoAd.onLoad(()=>{console.log("激励视频加载成功"),this.videoLoaded=!0}),this.videoAd.onError(e=>{console.log("video Error:",JSON.stringify(e)),this.videoIsError=!0}),this.videoAd.onClose(t=>{t&&t.isEnded||void 0===t?(console.log("正常播放结束，可以下发游戏奖励"),this.videoCallback()):console.log("播放中途退出，不下发游戏奖励"),this.closeVCB&&this.closeVCB(),this.closeVCB=null,e.isMusic&&(Laya.SoundManager.muted=!1),this.loadVideo()})}loadVideo(){null!=this.videoAd&&(this.videoIsError=!1,this.videoLoaded=!1,this.videoAd.load())}showVideo(e){this.videoCallback=e,Laya.Browser.onWeiXin?this.videoIsError?this.videoCallback():(Laya.SoundManager.muted=!0,this.videoAd.show()):this.videoCallback()}}class p{constructor(){this.isRecording=!1,this.recorder=null,this.videoPath=""}static get instance(){return this._instance||(this._instance=new p),this._instance}initRecorder(){Laya.Browser.onWeiXin&&(this.recorder=window.tt.getGameRecorderManager(),this.onStopListener(),this.onInterrupBegin(),this.onInterrupEnd())}recordStart(){Laya.Browser.onWeiXin&&(console.log("录屏开始"),this.recorder.start({duration:300}),this.isRecording=!0)}recordPause(){Laya.Browser.onWeiXin&&(console.log("录屏暂停"),this.recorder.pause())}recordResume(){Laya.Browser.onWeiXin&&(console.log("录屏继续"),this.recorder.resume())}recordStop(){Laya.Browser.onWeiXin&&this.isRecording&&(console.log("录屏停止"),this.recorder.stop())}onStopListener(){this.recorder.onStop(e=>{console.log("录屏结束：",e.videoPath),this.videoPath=e.videoPath,this.isRecording=!1})}shareVideo(t){""!=this.videoPath?window.tt.shareAppMessage({channel:"video",extra:{videoPath:this.videoPath,videoTopics:["我画你杀","抖音小游戏"],createChallenge:!0},success:()=>{console.log("分享成功"),t&&t()},fail:t=>{console.log("分享失败"),e.OpenAlert("分享失败！")}}):e.OpenAlert("请开始游戏录制视频！")}onInterrupBegin(){this.recorder.onInterruptionBegin(()=>{console.log("录屏被打断开始"),this.recordPause()})}onInterrupEnd(){this.recorder.onInterruptionEnd(()=>{console.log("录屏被打断结束"),this.recordResume()})}}class g extends Laya.Scene{constructor(){super(),this.touchPanel=this.touchPanel,this.touchNode=this.touchNode,this.drawSp=this.drawSp,this.btnNode=this.btnNode,this.noPowerNode=this.noPowerNode,this.upgradeNode=this.upgradeNode,this.closeUpgradePlane=this.closeUpgradePlane,this.moveNode=this.moveNode,this.item1=this.item1,this.item2=this.item2,this.item3=this.item3,this.getPowerBtn=this.getPowerBtn,this.upgradeBtn=this.upgradeBtn,this.skinBtn=this.skinBtn,this.reviveBtn=this.reviveBtn,this.startBtn=this.startBtn,this.overNode=this.overNode,this.bottomNode=this.bottomNode,this.gameOverNode=this.gameOverNode,this.helpBtn=this.helpBtn,this.giveUpBtn=this.giveUpBtn,this.gameOverBtnNode=this.gameOverBtnNode,this.playerHp=this.playerHp,this.aiHp=this.aiHp,this.shareVideo=this.shareVideo,this.touchStarted=!1,this.startPos=null,this.lineArr=[],this.lineArrVec2=[],this.weaponNode=this.weaponNode,this.polyNode=this.polyNode,this.weaponPicNode=this.weaponPicNode,this.weaponTips=this.weaponTips,this.godWeaponBtn=this.godWeaponBtn,this.refreshBtn=this.refreshBtn,this.cmds=[],this.pointsArr=[],this.refreshArr=[],this.curWeaponId=-1}onOpened(t){if(g.Share=this,this.initData(),t&&t(),Laya.timer.frameLoop(1,this,this.checkIsNoPower),i.getPlayerData().grade>=2&&0==i.getPlayerData().gradeIndex){localStorage.getItem("weapon0")||(Laya.Scene.open("MyScenes/FoundWeaponUI.scene",!1,0),localStorage.setItem("weapon0","1")),localStorage.getItem("weaponGrade")||localStorage.setItem("weaponGrade","0");for(let e=1;e<9;e++)if(!localStorage.getItem("weapon"+e)&&2*e-parseInt(localStorage.getItem("weaponGrade"))==0){localStorage.setItem("weapon"+e,"1"),Laya.Scene.open("MyScenes/FoundWeaponUI.scene",!1,e);break}Laya.timer.frameOnce(1,this,this.initWeaponData)}this.godWeaponBtn.visible=i.getPlayerData().grade>=2,e.launchGameUI?localStorage.getItem("guide")&&i.getPlayerData().grade>1&&0==i.getPlayerData().gradeIndex&&i.getFreeSkins().length>0&&(e.ExtractUIGapGrade>0?e.ExtractUIGapGrade--:Laya.timer.once(100,this,()=>{Laya.Scene.open("MyScenes/ExtractUI.scene",!1)})):(e.GetLaunchParam(e=>{let t=i.getPlayerData().exitTime;if(t>0){let e=(new Date).getTime(),a=Math.floor((e-t)/1e3/60);a>=1&&Laya.Scene.open("MyScenes/OfflineUI.scene",!1,a)}}),e.launchGameUI=!0,f.Share.checkCanUpgrade()),this.drawTips.visible=i.getPlayerData().grade<=1,this.drawTips.skin=1==i.getPlayerData().grade?"mainUI/sy_ck2.png":"mainUI/sy_ck1.png",localStorage.getItem("guide")||1!=i.getPlayerData().grade?this.fingerAni.visible=!1:this.fingerAni.visible=!0,s.instance.playMusic("bgm.mp3"),y.instance.hideBanner()}onClosed(){Laya.timer.clearAll(this)}initData(){this.touchPanel.y=t.fixPosY(this.touchPanel.y),this.bottomNode.y=t.fixPosY(this.bottomNode.y),this.gameOverBtnNode.y=t.fixPosY(this.gameOverBtnNode.y),this.touchNode.on(Laya.Event.MOUSE_DOWN,this,this.touchStart),this.touchNode.on(Laya.Event.MOUSE_MOVE,this,this.touchMove),this.touchNode.on(Laya.Event.MOUSE_UP,this,this.touchEnd),this.touchNode.on(Laya.Event.MOUSE_OUT,this,this.touchOut),this.upgradeBtn.on(Laya.Event.CLICK,this,this.upgradeBtnCB),this.skinBtn.on(Laya.Event.CLICK,this,this.skinBtnCB),this.item1.on(Laya.Event.CLICK,this,this.upgradePlayerCountCB),this.item2.on(Laya.Event.CLICK,this,this.upgradePlayerAtkCB),this.item3.on(Laya.Event.CLICK,this,this.upgradeOfflineCB),this.reviveBtn.on(Laya.Event.CLICK,this,this.reviveBtnCB),this.startBtn.on(Laya.Event.CLICK,this,this.startCB),this.helpBtn.on(Laya.Event.CLICK,this,this.helpBtnCB),this.giveUpBtn.on(Laya.Event.CLICK,this,this.giveUpBtnCB),this.getPowerBtn.on(Laya.Event.CLICK,this,this.getPowerBtnCB),this.shareVideo.on(Laya.Event.CLICK,this,this.shareVideoCB),this.updatePlayerItem(),Laya.timer.loop(1e3,this,this.updatePlayerItem),f.Share.canTouch=!0}updatePlayerItem(){let e=null,t=!1;for(let a=1;a<=3;a++){let s=(e=this["item"+a]).getChildByName("lvNum"),n=e.getChildByName("cost"),r=e.getChildByName("panel");switch(a){case 1:s.text="等级："+i.getPlayerCountLv().toString(),n.text=i.getUpgradePlayerCountLvCost().toString(),r.visible=i.getUpgradePlayerCountLvCost()>i.getPlayerData().coin||i.getCountLvMax();break;case 2:s.text="等级："+i.getPlayerPowerLv().toString(),n.text=i.getUpgradePlayerPowerLvCost().toString(),r.visible=i.getUpgradePlayerPowerLvCost()>i.getPlayerData().coin||i.getPowerLvMax();break;case 3:s.text="等级："+i.getPlayerOfflineLv().toString(),n.text=i.getUpgradeOfflineLvCost().toString(),r.visible=i.getUpgradeOfflineLvCost()>i.getPlayerData().coin||i.getOfflineLvMax()}r.visible||(t=!0)}this.upgradeBtn.getChildAt(0).visible=t}touchStart(t){if(this.safeArea(new Laya.Vector2(t.stageX,t.stageY))&&f.Share.canTouch){if(this.fingerAni.visible=!1,localStorage.getItem("guide")||localStorage.setItem("guide","1"),0==i.getPlayerData().gradeIndex&&!f.Share.gameStarted)switch(i.getPlayerData().power--,i.setPlayerData(),f.Share.gameStarted=!0,p.instance.recordStart(),i.getPlayerData().grade){case 1:e.ttEvent("Event_4");break;case 2:e.ttEvent("Event_5");break;case 3:e.ttEvent("Event_6");break;case 4:e.ttEvent("Event_7");break;case 5:e.ttEvent("Event_8");break;case 6:e.ttEvent("Event_9")}this.touchStarted=!0,this.startPos=new Laya.Vector2(t.stageX,t.stageY),this.lineArr=[],this.lineArr.push(this.startPos.x),this.lineArr.push(this.startPos.y),this.lineArrVec2=[],this.lineArrVec2.push(this.startPos)}}touchMove(e){if(!this.safeArea(new Laya.Vector2(e.stageX,e.stageY))||!this.touchStarted)return;let a=new Laya.Vector2(e.stageX,e.stageY);t.calcDistance(this.startPos,a)>=10&&this.lineArrVec2.length<f.WEAPON_LENGTH_MAX&&(this.lineArr.push(a.x),this.lineArr.push(a.y),this.lineArrVec2.push(a),this.startPos=a,this.drawLine())}touchEnd(t){if(!this.touchStarted)return;if(this.touchStarted=!1,this.drawSp.graphics.clear(),this.lineArrVec2.length<f.WEAPON_LENGTH_MIN)return void e.OpenAlert("武器太短啦，请重画！");let a=this.checkLineInPoly(this.lineArrVec2);console.log("polyId:",a),-1!=a?(f.Share.createGodWeapon(a),this.dealWithAddWeapon(a)):f.Share.createLine3D(this.lineArrVec2)}touchOut(t){if(!this.touchStarted)return;if(this.touchStarted=!1,this.drawSp.graphics.clear(),this.lineArrVec2.length<f.WEAPON_LENGTH_MIN)return void e.OpenAlert("武器太短啦，请重画！");let a=this.checkLineInPoly(this.lineArrVec2);console.log("polyId:",a),-1!=a?(f.Share.createGodWeapon(a),this.dealWithAddWeapon(a)):f.Share.createLine3D(this.lineArrVec2)}drawLine(){this.drawSp.graphics.clear(),this.drawSp.graphics.drawLines(0,0,this.lineArr,"#000000",8)}safeArea(e){let t=this.touchPanel.x-this.touchPanel.width/2,a=this.touchPanel.x+this.touchPanel.width/2,i=this.touchPanel.y-this.touchPanel.height/2,s=this.touchPanel.y+this.touchPanel.height/2;return!(e.x<t||e.x>a||e.y<i||e.y>s)}upgradeBtnCB(){this.upgradeNode.visible||(e.aldEvent("首页升级按钮：点击"),this.upgradeNode.visible=!0,t.tMove2D(this.moveNode,-606,this.moveNode.y,200,()=>{this.closeUpgradePlane.off(Laya.Event.CLICK,this,this.closeUpgradeNode),this.closeUpgradePlane.on(Laya.Event.CLICK,this,this.closeUpgradeNode)}))}closeUpgradeNode(){this.closeUpgradePlane.off(Laya.Event.CLICK,this,this.closeUpgradeNode),t.tMove2D(this.moveNode,0,this.moveNode.y,200,()=>{this.upgradeNode.visible=!1})}skinBtnCB(){e.aldEvent("皮肤界面：点击"),Laya.Scene.open("MyScenes/SkinUI.scene",!1,()=>{})}upgradePlayerCountCB(){i.getPlayerCountLv()>=5||(i.getPlayerData().coin<i.getUpgradePlayerCountLvCost()?e.OpenAlert("金币不足！"):(e.aldEvent("升级界面：人数"),i.changeCoin(-i.getUpgradePlayerCountLvCost()),i.upgradePlayerCountLv(),this.updatePlayerItem(),f.Share.upgradePlayerCount(),o.Share.initData()))}upgradePlayerAtkCB(){i.getPlayerPowerLv()>=35||(i.getPlayerData().coin<i.getUpgradePlayerPowerLvCost()?e.OpenAlert("金币不足！"):(e.aldEvent("升级界面：攻击力"),i.changeCoin(-i.getUpgradePlayerPowerLvCost()),i.upgradePlayerPowerLv(),this.updatePlayerItem(),o.Share.initData()))}upgradeOfflineCB(){i.getPlayerOfflineLv()>=56||(i.getPlayerData().coin<i.getUpgradeOfflineLvCost()?e.OpenAlert("金币不足！"):(e.aldEvent("升级界面：离线收益"),i.changeCoin(-i.getUpgradeOfflineLvCost()),i.upgradePlayerOfflineLv(),this.updatePlayerItem(),o.Share.initData()))}visibleOverNode(t){t&&e.aldEvent("复活战士按钮弹出展示"),this.touchPanel.visible=!t,this.overNode.visible=t,this.upgradeBtn.visible=!t,this.skinBtn.visible=!t,this.shareVideo.visible=!t,this.refreshBtn.visible=!t&&i.getPlayerData().grade>=2}reviveBtnCB(){f.Share.revivePlayer(),this.visibleOverNode(!1)}startCB(){this.visibleOverNode(!1),f.Share.goAhead()}visibleBottomUI(e){this.touchPanel.visible=e,this.upgradeBtn.visible=e,this.skinBtn.visible=e,this.shareVideo.visible=e,this.godWeaponBtn.visible=e&&i.getPlayerData().grade>=2,this.refreshBtn.visible=e&&i.getPlayerData().grade>=2}visibleGameOverNode(e){this.gameOverNode.visible=e}helpBtnCB(){e.aldEvent("请求帮助：点击");y.instance.showVideo(()=>{e.aldEvent("请求帮助：成功"),this.visibleGameOverNode(!1),f.Share.isHelpStart=!0,f.Share.tempPlayerCount=1,f.Share.restartGame()})}giveUpBtnCB(){p.instance.recordStop(),e.aldEvent("第"+i.getPlayerData().grade+"关：失败"),f.Share.isHelpStart=!1,f.Share.gradeIndex=0,i.getPlayerData().gradeIndex=0,i.setPlayerData(),Laya.Scene.open("MyScenes/GameUI.scene"),f.Share.restartGame()}createHpBar(e){let t=l.instance().getItem(h.HpBar);this.playerHp.addChild(t),t.addComponent(d).initData(e)}createSmile(e){let t=l.instance().getItem(h.Smile);this.addChild(t),t.getComponent(c).initData(e)}createCry(e){let t=l.instance().getItem(h.Cry);this.addChild(t),t.getComponent(c).initData(e)}getPowerBtnCB(){e.aldEvent("获得体力：点击");y.instance.showVideo(()=>{e.aldEvent("获得体力：成功"),i.getPlayerData().power+=5,i.setPlayerData(),this.refreshBtn.visible=!0})}checkIsNoPower(){if(0==i.getPlayerData().gradeIndex&&!f.Share.gameStarted&&!f.Share.isHelpStart){let e=i.getPlayerData().power;this.touchPanel.visible=e>0,this.touchNode.visible=e>0,this.noPowerNode.visible=e<=0}}createCoinBoom(e){let a=new Laya.Vector4(0,0,0),i=e.transform.position.clone();i.y+=1.75,f.Share._camera.viewport.project(i,f.Share._camera.projectionViewMatrix,a);let s=new Laya.Vector2(a.x/Laya.stage.clientScaleX,a.y/Laya.stage.clientScaleY),n=new Laya.Vector2(75,100);t.coinCollectAnim(s,n,this),o.Share.initData()}shareVideoCB(){e.ttEvent("Event_20"),p.instance.shareVideo()}initWeaponData(){this.godWeaponBtn.on(Laya.Event.CLICK,this,this.clickGodWeapon),this.refreshBtn.on(Laya.Event.CLICK,this,this.refreshBtnCB);for(let e=0;e<this.weaponPicNode.numChildren;e++)localStorage.getItem("weapon"+e)&&this.refreshArr.push(e);this.refreshWeaponTips(),this.cmds=this.polyNode.graphics.cmds;let e=this.polyNode.localToGlobal(new Laya.Point(0,0));for(let t=0;t<this.cmds.length;t++){let a=this.cmds[t].points,i=[];for(let t=0;t<a.length;t++)if(t>0&&t%2!=0){let s=new Laya.Vector2(a[t-1],a[t]);s.x+=e.x+22,s.y+=e.y+23,i.push(s)}this.pointsArr.push(i)}}checkLineInPoly(e){let a=[0,1,2,3,4,5,6,7,8];for(let i=0;i<this.pointsArr.length;i++){let s=this.pointsArr[i];for(let n=0;n<e.length;n++)if(!t.pointInPolygon(e[n],s)){a.splice(a.indexOf(i),1);break}}if(a.length<=0)return-1;for(let t=0;t<this.weaponPicNode.numChildren;t++){if(-1==a.indexOf(t))continue;let i=this.weaponPicNode.getChildAt(t).getChildByName("pointNode"),s=[];for(let e=0;e<i.numChildren;e++){let t=i.getChildAt(e),a=i.localToGlobal(new Laya.Point(t.x,t.y));s.push(new Laya.Vector2(a.x,a.y))}this.checkPointDistancePoint(s,e)||a.splice(a.indexOf(t),1)}return a.length<=0?-1:-1!=a.indexOf(this.curWeaponId)&&localStorage.getItem("weapon"+this.curWeaponId)?this.curWeaponId:-1}checkPointDistancePoint(e,a){for(let i=0;i<e.length;i++){let s=e[i],n=!1;for(let e=0;e<a.length;e++){let i=a[e];if(t.calcDistance(s,i)<50){n=!0;break}}if(!n)return!1}return!0}clickGodWeapon(){Laya.Scene.open("MyScenes/WeaponDicUI.scene",!1)}hideAllWeaponPics(){for(let e=0;e<this.weaponPicNode.numChildren;e++){this.weaponPicNode.getChildAt(e).visible=!1}}refreshWeaponTips(){if(this.weaponTips.visible=!1,this.refreshArr.length<=0)return;let e=t.getRandomItemInArr(this.refreshArr);this.curWeaponId=e,this.hideAllWeaponPics(),this.weaponPicNode.getChildAt(e).visible=!0,this.weaponTips.visible=!0,this.refreshBtn.visible=this.weaponTips.visible&&this.refreshArr.length>1&&this.touchPanel.visible}refreshBtnCB(){let e=[].concat(this.refreshArr);if(e.length<=0)return void(this.refreshBtn.visible=!1);if(e.splice(e.indexOf(this.curWeaponId),1),e.length<=0)return void(this.refreshBtn.visible=!1);let a=t.getRandomItemInArr(e);this.curWeaponId=a,this.hideAllWeaponPics(),this.weaponPicNode.getChildAt(a).visible=!0,this.refreshBtn.visible=this.weaponTips.visible}dealWithAddWeapon(e){this.refreshArr.splice(this.refreshArr.indexOf(e),1),this.weaponPicNode.getChildAt(this.curWeaponId).visible=!1,this.curWeaponId=-1,this.refreshWeaponTips()}}class u extends Laya.Script{constructor(){super(),this.myOwner=null,this._ani=null,this.weaponNode=null,this.enemyNode=null,this.embNode=null,this.closeNode=null,this.isPlayer=!0,this.isHited=!1,this.haveWeapon=!1,this.isDied=!1,this.fightStarted=!1,this.weaponLength=5,this.walkSpeed=.08,this.myId=0,this.backDistance=8,this.weaponSpeed=1,this.hpMax=100,this.hp=100,this.atk=20,this.embScale=null,this.embPos=null,this.embRotation=null,this.isBossState=!1,this.backDisTemp=0,this.healValue=0,this.isAllDamage=!1,this.decDamage=0,this.isOneKill=!1}onAwake(){this.myOwner=this.owner,this._ani=this.owner.getComponent(Laya.Animator),this.playIdle1(),this.weaponNode=t.findNodeByName(this.myOwner,"Dummy_Arms"),this.embNode=t.findNodeByName(this.myOwner,"Dummy_Emb");let e=t.findNodeByName(this.myOwner,"Hero1_Emb");this.embScale=e.transform.localScale.clone(),this.embPos=e.transform.localPosition.clone(),this.embRotation=e.transform.localRotation.clone()}initData(e,t){this.myId=e,this.isPlayer=t,this.isPlayer||this.playIdle2(),t&&(this.changeSkin(-1!=i.freeSkinId?i.freeSkinId:i.getPlayerData().playerId),this.hp=i.getPlayerPowerData().hp,this.hpMax=this.hp,this.atk=i.getPlayerPowerData().atk)}playIdle1(){this._ani.speed=1,this._ani.crossFade("idle1",.05)}playIdle2(){this._ani.speed=1,this._ani.crossFade("idle2",.05)}playWalk(){this._ani.play("walk",0,0),this._ani.crossFade("hit",.05,1),this._ani.getControllerLayer(1).getAnimatorState("hit").speed=this.getPlayerAniSpeed()}playDied(){this._ani.crossFade("died",.05),this._ani.getControllerLayer(1).getAnimatorState("hit").speed=0}getPlayerAniSpeed(){let e=this.weaponLength;return e>50?this.weaponSpeed-this.weaponSpeed*(e-50)*.01:this.weaponSpeed}getHitbackDistance(e){let t=this.weaponLength;if(t>50){let a=this.backDistance-this.backDistance*(t-50)*.01;return e?a*(1+e.backDisTemp):a}return e?this.backDistance*(1+e.backDisTemp):this.backDistance}addGodWeapon(t){let a=Laya.loader.getRes(e.UnityPath+"H_Arms_"+(t+1)+".lh"),i=Laya.Sprite3D.instantiate(a,null,!0,new Laya.Vector3(0,0,0));this.addWeapon(i),this.addWeaponData(t)}addWeapon(e){this.weaponNode.addChild(e),this.weaponLength=this.weaponNode.getChildAt(0).numChildren>100?100:this.weaponNode.getChildAt(0).numChildren,e.transform.localPosition=new Laya.Vector3(0,0,0),this.haveWeapon=!0,this.weaponNode.numChildren>30&&(this.atk=this.atk*(1+.005*(this.weaponNode.numChildren-30))),this.isPlayer&&s.instance.playSoundEffect("weaponReady.mp3"),this.playIdle2()}removeWeapon(){this.weaponNode.destroyChildren()}goToFight(e){this.isPlayer?(this.hp==this.hpMax&&(this.hp=i.getPlayerPowerData().hp,this.hpMax=this.hp),this.atk=this.isOneKill?9999999:i.getPlayerPowerData().atk):(this.hp==this.hpMax&&(this.hp=i.getNpcData().hp,this.hpMax=this.hp),this.atk=i.getNpcData().atk),this.fightStarted=!0,this.enemyNode=e,this.isBossState=i.getPlayerData().gradeIndex>=3,this.playWalk()}onUpdate(){if(this.enemyNode&&this.enemyNode.numChildren>0&&!this.isHited&&!this.isDied&&this.fightStarted&&!f.Share.pauseGame){let e=this.myOwner.transform.position.clone(),a=99999,i=null;for(let t=0;t<this.enemyNode.numChildren;t++){let s=this.enemyNode.getChildAt(t);if(!s||!s.transform)continue;let n=s.getComponent(u);if(n&&n.isDied)continue;let r=Laya.Vector3.distance(e,s.transform.position.clone());r<a&&(a=r,i=s)}if(this.closeNode&&this.closeNode.transform&&this.closeNode.getComponent(u)&&!this.closeNode.getComponent(u).isDied?i=this.closeNode:(this.closeNode=null,this.closeNode=i),!i)return;this.myOwner.transform.lookAt(i.transform.position,new Laya.Vector3(0,1,0)),this.myOwner.transform.rotate(new Laya.Vector3(0,180,0),!0,!1);let s=t.getDirectionAToB(this.myOwner,i);s=new Laya.Vector3(s.x*this.walkSpeed,s.y*this.walkSpeed,s.z*this.walkSpeed);let n=new Laya.Vector3(0,0,0);if(Laya.Vector3.add(e,s,n),this.isBossState&&a<6)return;if(!this.isBossState&&a<.5)return;this.myOwner.transform.position=n}}onLateUpdate(){this.weaponNode&&this.enemyNode&&this.enemyNode.numChildren>0&&!this.isHited&&!this.isDied&&this.fightStarted&&!f.Share.pauseGame&&this.checkIsHitEnemy()}checkIsHitEnemy(){let e=this.weaponNode.getChildAt(0);if(e&&null!=e&&null!=e&&!this.isDied)for(let t=0;t<e.numChildren;t++){let a=e.getChildAt(t),i=a.transform.position.clone();i.y=0;for(let e=0;e<this.enemyNode.numChildren;e++){let t=this.enemyNode.getChildAt(e),s=t.transform.position.clone();s.y=0;let r=Laya.Vector3.distance(i,s);if(!this.isBossState&&r<=1){if(this.isAllDamage)for(let e=0;e<this.enemyNode.numChildren;e++){let t=this.enemyNode.getChildAt(e).getComponent(u);t&&t.hitBack(a,.4*this.atk,this.myOwner)}else{t.getComponent(u).hitBack(a,this.atk,this.myOwner)}return}if(this.isBossState&&r<=5){return void t.getComponent(n).hitBack(this.atk)}}}}hitBack(a,i,n){if(this.isDied||this.isHited)return;this.isPlayer||e.DoVibrate();let r=t.GetRandom(1,4);if(s.instance.playSoundEffect("weaponHit"+r+".mp3"),this.createHitFX(),this.hp-=i*(1-this.decDamage),this.hp<=0){if(this.isPlayer)g.Share.createSmile(n);else if(g.Share.createCry(this.myOwner),g.Share.createCoinBoom(this.myOwner),f.Share.getCoinNum+=10,s.instance.playSoundEffect("getCoin.mp3"),n){let e=n.getComponent(u);e.hp=e.hp+e.hpMax*e.healValue,e.hp>e.hpMax&&(e.hp=e.hpMax)}let e=t.GetRandom(1,2);return s.instance.playSoundEffect("die"+e+".mp3"),this.isDied=!0,this.playDied(),void Laya.timer.once(1e3,this,()=>{this.owner.destroy()})}this.isHited=!0;let o=a.transform.position.clone(),h=this.myOwner.transform.position.clone(),l=new Laya.Vector3(0,0,0);Laya.Vector3.subtract(h,o,l),Laya.Vector3.normalize(l,l),l=new Laya.Vector3(l.x*this.getHitbackDistance(n?n.getComponent(u):null),0,l.z*this.getHitbackDistance(n?n.getComponent(u):null));let d=this.myOwner.transform.position.clone();Laya.Vector3.add(d,l,d),t.TmoveTo(this.myOwner,200,d,()=>{this.isHited=!1})}createHitFX(){let t=Laya.loader.getRes(e.UnityPath+"hitFX.lh"),a=Laya.Sprite3D.instantiate(t,this.myOwner,!0,new Laya.Vector3(0,2,0));a.transform.localPosition=new Laya.Vector3(0,1.5,0),Laya.timer.once(1e3,f.Share,()=>{a.destroy()})}changeSkin(t){let a=new Laya.UnlitMaterial;Laya.Texture2D.load("res/skinHero/HeroD_"+(t+1)+".png",Laya.Handler.create(this,function(e){a.albedoTexture=e}));for(let e=1;e<=4;e++){this.owner.getChildAt(e).skinnedMeshRenderer.material=a}this.embNode.destroyChildren();let i=Laya.loader.getRes(e.UnityPath+"Hero"+(t+1)+"_Emb.lh"),s=Laya.Sprite3D.instantiate(i,this.embNode,!1,new Laya.Vector3(0,0,0));s.transform.localScale=this.embScale,s.transform.localPosition=this.embPos,s.transform.localRotation=this.embRotation}addWeaponData(e){switch(e){case 0:this.walkSpeed=1.1*this.walkSpeed;break;case 1:this.weaponSpeed=1.3*this.weaponSpeed;break;case 2:this.backDisTemp=.3;break;case 3:this.atk=1.3*this.atk;break;case 4:this.walkSpeed=.9*this.walkSpeed,this.isOneKill=!0;break;case 5:this.healValue=.25;break;case 6:this.isAllDamage=!0;break;case 7:this.decDamage=.3;break;case 8:this.weaponSpeed=1.1*this.weaponSpeed,Laya.timer.loop(1e3,this,()=>{this.hp>0&&(this.hp+=.02*this.hpMax,this.hp>this.hpMax&&(this.hp=this.hpMax))})}}}class m{constructor(){this.path="",this.picCount=3,this.preT=0,this.shareTips=["请分享到活跃的群！","请分享到不同群！","请分享给好友！","请分享给20人以上的群！"]}static get instance(){return this._instance||(this._instance=new m),this._instance}initShare(){if(Laya.Browser.onWeiXin){Laya.Browser.window.wx.showShareMenu({withShareTicket:!0});let t="res/share/share.png",a="我画你杀，谁与争锋";Laya.Browser.window.wx.onShareAppMessage(function(e){return{title:a,imageUrl:t}}),Laya.Browser.window.wx.onShow(t=>{if(s.instance.playMusic("bgm.mp3"),e.shareCallback){((new Date).getTime()-e.shareTime)/1e3>=3&&!e.firstShare?(e.shareCallback(),e.front_share_number--,Laya.Browser.window.wx.showToast({title:"分享成功",icon:"none",duration:2e3}),e.shareCallback=null):(e.firstShare=!1,Laya.Browser.window.wx.showModal({title:"提示",content:this.shareTips[Math.floor(Math.random()*this.shareTips.length)],confirmText:"重新分享",success(t){t.confirm?(console.log("用户点击确定"),m.instance.shareGame(e.shareCallback)):t.cancel&&console.log("用户点击取消")}}))}})}}shareGame(t){if(e.front_share_number<=0)return void y.instance.showVideo(t);if(e.shareCallback=t,!Laya.Browser.onWeiXin)return void t();e.shareTime=(new Date).getTime();Laya.Browser.window.wx.shareAppMessage({title:"我画你杀，谁与争锋",imageUrl:"res/share/share.png"})}}const L=.1,C=3,w=30;class f{constructor(){this._playerNode=new Laya.Sprite3D,this._aiNode=new Laya.Sprite3D,this.circleEffect=new Laya.Sprite3D,this.camStartPos=new Laya.Vector3(0,0,0),this.canTouch=!1,this.gameStarted=!1,this.canReady=!1,this.isHelpStart=!1,this.pauseGame=!1,this.gradeIndex=0,this.tempPlayerCount=0,this.getCoinNum=0;for(let e=0;e<9;e++)localStorage.setItem("weapon"+e,"1");i.getPlayerData().coin=999999,i.setPlayerData(),y.instance.initAd(),p.instance.initRecorder(),t.loadJson("res/config/aiConfig.json",e=>{i.aiConfig=e}),t.loadJson("res/config/posConfig.json",e=>{i.posConfig=e}),i.getPlayerData(),l.instance(),new r,m.instance.initShare(),i.getPlayerData().gradeIndex=0,this.gradeIndex=i.getPlayerData().gradeIndex,f.Share=this,e.httpRequest("https://tthy.jiujiuhuyu.com/tt/weapon/config.json","version="+e.version,"get",t=>{t=JSON.parse(t),e.configData=t.data.config,0==e.configData.is_allow_area&&(e.configData.front_box_wudian_switch=!1,e.configData.give_gold_switch=!1,e.configData.GQQT_kg=!1,e.configData.GQQT_GQKZ=1,e.configData.GXQT_kg=3),console.log("加载后台配置完成:",t)}),this.loadAtlas(),e.WxOnHide(()=>{i.setExitTime(),localStorage.setItem("lastDate",(new Date).getDate().toString()),localStorage.setItem("front_share_number",e.front_share_number.toString())})}loadAtlas(){var e=[{url:"res/atlas/finishUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/finishUI.png",type:Laya.Loader.IMAGE},{url:"res/atlas/mainUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/mainUI.png",type:Laya.Loader.IMAGE},{url:"res/atlas/offlineUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/offlineUI.png",type:Laya.Loader.IMAGE},{url:"res/atlas/normalUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/normalUI.png",type:Laya.Loader.IMAGE},{url:"res/atlas/heroSkins.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/heroSkins.png",type:Laya.Loader.IMAGE},{url:"res/atlas/freeSkins.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/freeSkins.png",type:Laya.Loader.IMAGE},{url:"res/atlas/skinUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/skinUI.png",type:Laya.Loader.IMAGE},{url:"res/atlas/boxUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/boxUI.png",type:Laya.Loader.IMAGE},{url:"res/atlas/TTRes.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/TTRes.png",type:Laya.Loader.IMAGE},{url:"res/atlas/clickBoxUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/clickBoxUI.png",type:Laya.Loader.IMAGE},{url:"res/atlas/extractUI.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/extractUI.png",type:Laya.Loader.IMAGE},{url:"res/atlas/weaponRes.atlas",type:Laya.Loader.ATLAS},{url:"res/atlas/weaponRes.png",type:Laya.Loader.IMAGE}];Laya.loader.load(e,Laya.Handler.create(this,function(){Laya.Scene.open("MyScenes/LoadingUI.scene")}))}initScene(){Laya.Scene3D.load(e.UnityPath+"MyScene.ls",Laya.Handler.create(this,this.onLoadScene))}onLoadScene(t){this._scene=Laya.stage.addChild(t),Laya.stage.setChildIndex(this._scene,0),this._scene.addChild(this._playerNode),this._scene.addChild(this._aiNode),this._camera=this._scene.getChildByName("Main Camera"),this._light=this._scene.getChildByName("Directional Light"),this._plane=this._scene.getChildByName("Plane"),this.camStartPos=this._camera.transform.position.clone(),this.fixCameraField();let a=Laya.loader.getRes(e.UnityPath+"Circle_1.lh");this.circleEffect=Laya.Sprite3D.instantiate(a,this._scene,!0,new Laya.Vector3(0,.1,0)),this.circleEffect.active=!1,Laya.timer.frameLoop(1,this,this.updateCircle)}fixCameraField(){let e=(Laya.stage.displayHeight-1334<0?0:Laya.stage.displayHeight-1334)/290*10;this._camera.fieldOfView=70+e}moveCamera(e,a=2e3){let i=this._camera,s=i.transform.position.clone();s.z+=e,t.TmoveTo(i,a,s,()=>{})}createPlayer(){let t=Laya.loader.getRes(e.UnityPath+"Hero_1.lh"),a=(i.getPlayerCount()+this.tempPlayerCount-1)*C/2;for(let e=0;e<i.getPlayerCount()+this.tempPlayerCount;e++){let i=Laya.Sprite3D.instantiate(t,this._playerNode,!1,new Laya.Vector3(0,0,0));i.addComponent(u).initData(e,!0),i.transform.translate(new Laya.Vector3(a,0,w*this.gradeIndex),!1),a-=C,g.Share.createHpBar(i)}}pushPlayer(){let t=Laya.loader.getRes(e.UnityPath+"Hero_1.lh"),a=(i.getPlayerCount()-1)*C/2;for(let e=0;e<i.getPlayerCount();e++){if(e+1<=this._playerNode.numChildren){a-=C;let t=this._playerNode.getChildAt(e).getComponent(u);t.hp=t.hpMax;continue}let i=Laya.Sprite3D.instantiate(t,this._playerNode,!1,new Laya.Vector3(0,0,0));i.addComponent(u).initData(e,!0),i.transform.translate(new Laya.Vector3(a,0,w*this.gradeIndex),!1),a-=C,g.Share.createHpBar(i)}}updateCircle(){if(!this._playerNode||this._playerNode.numChildren<=0)this.circleEffect.active=!1;else{for(let e=0;e<this._playerNode.numChildren;e++){let t=this._playerNode.getChildAt(e);if(!t.getComponent(u).haveWeapon){let e=t.transform.position.clone(),a=new Laya.Vector3(e.x,.1,e.z+.1);return this.circleEffect.transform.position=a,void(this.circleEffect.active=!0)}}this.circleEffect.active=!1}}createAi(){if(i.getPlayerData().gradeIndex>=3)return void this.createBoss();let a=null,s=0,n=[],r=[],o=0;i.getPlayerData().grade>19?(n=i.posConfig.sort,s=t.GetRandom(0,9),r=t.getRandomItemInArr(n),o=t.GetRandom(1,7)):(s=(a=i.aiConfig["grade"+i.getPlayerData().grade]).skinId,r=(n=a.sort)[i.getPlayerData().gradeIndex]),this._aiNode.transform.position=new Laya.Vector3(0,0,10+w*this.gradeIndex);let h=Laya.loader.getRes(e.UnityPath+"Hero_1.lh"),l=C;for(let t=0;t<r.length;t++){let a=Laya.Sprite3D.instantiate(h,this._aiNode,!0,new Laya.Vector3(0,0,0)),n=a.addComponent(u);n.initData(t,!1),n.changeSkin(s),a.transform.localPosition.x=r[t][0]*l,a.transform.localPosition.y=0,a.transform.localPosition.z=r[t][1]*l,a.transform.rotate(new Laya.Vector3(0,180,0),!0,!1),g.Share.createHpBar(a);let d=i.getPlayerData().grade>19?o:r[t][2]+1,c=Laya.loader.getRes(e.UnityPath+"Arms_"+d+".lh"),y=Laya.Sprite3D.instantiate(c,null,!0,new Laya.Vector3(0,0,0));n.addWeapon(y)}}createBoss(){this._aiNode.transform.position=new Laya.Vector3(0,0,10+w*this.gradeIndex);let t=Laya.loader.getRes(e.UnityPath+"Hero_Boss.lh");t.getComponent(Laya.Animator).getControllerLayer().playOnWake=!1;let a=Laya.Sprite3D.instantiate(t,this._aiNode,!0,new Laya.Vector3(0,0,0));a.addComponent(n);a.transform.localPosition.x=0,a.transform.localPosition.y=0,a.transform.localPosition.z=0,a.transform.rotate(new Laya.Vector3(0,180,0),!0,!1)}createGodWeapon(e){for(let t=0;t<this._playerNode.numChildren;t++){let a=this._playerNode.getChildAt(t).getComponent(u);if(!a.haveWeapon){a.addGodWeapon(e);break}}this.checkWeaponed()&&this.readyGo()}createLine3D(t){let a=new Laya.Sprite3D,i=Laya.loader.getRes(e.UnityPath+"line.lh"),s=new Laya.Vector3(0,0,0);for(let e=0;e<t.length;e++)if(0==e){let e=Laya.Sprite3D.instantiate(i,a,!1,new Laya.Vector3(0,0,0));e.transform.position=new Laya.Vector3(0,0,0),s=e.transform.position.clone()}else{let n=new Laya.Vector3(-t[e-1].x,0,-t[e-1].y),r=new Laya.Vector3(-t[e].x,0,-t[e].y),o=a.getChildAt(a.numChildren-1).transform.position.clone(),h=Laya.Vector3.distance(n,r);for(let e=0;e<Math.floor(h/10);e++){let t=Laya.Sprite3D.instantiate(i,a,!1,new Laya.Vector3(0,0,0)),h=new Laya.Vector3(0,0,0);Laya.Vector3.subtract(r,n,h),Laya.Vector3.normalize(h,h);let l=L*(e+1);h=new Laya.Vector3(h.x*l,h.y*l,h.z*l);let d=new Laya.Vector3(0,0,0);Laya.Vector3.add(o,h,d),t.transform.position=d,t.transform.position.z<s.z&&(s=t.transform.position.clone())}}for(let e=0;e<a.numChildren;e++){let t=a.getChildAt(e),i=new Laya.Vector3(0,0,0);Laya.Vector3.subtract(t.transform.position,s,i),t.transform.position=i}for(let e=0;e<this._playerNode.numChildren;e++){let t=this._playerNode.getChildAt(e).getComponent(u);if(!t.haveWeapon){t.addWeapon(a);break}}this.checkWeaponed()&&this.readyGo()}checkWeaponed(){let e=!0;for(let t=0;t<this._playerNode.numChildren;t++){this._playerNode.getChildAt(t).getComponent(u).haveWeapon||(e=!1)}return e}readyGo(){if(i.getFreeSkins().length>0&&!this.canReady&&0==i.getPlayerData().gradeIndex&&i.getPlayerData().grade>1)return p.instance.recordPause(),void Laya.Scene.open("MyScenes/FreeSkinUI.scene",!1);e.firstStartGame||(e.firstStartGame=!0,e.aldEvent("进入游戏后首次点击开始游戏")),0!=i.getPlayerData().gradeIndex||this.isHelpStart||(e.aldEvent("开始游戏"),e.aldEvent("第"+i.getPlayerData().grade+"关：进入")),this.canTouch=!1,g.Share.visibleBottomUI(!1);for(let e=0;e<this._playerNode.numChildren;e++){this._playerNode.getChildAt(e).getComponent(u).goToFight(this._aiNode)}if(i.getPlayerData().gradeIndex<3)for(let e=0;e<this._aiNode.numChildren;e++){this._aiNode.getChildAt(e).getComponent(u).goToFight(this._playerNode)}Laya.timer.clear(this,this.checkIsOver),Laya.timer.frameLoop(1,this,this.checkIsOver)}checkIsOver(){if(this._aiNode.numChildren<=0){if(this._playerNode.numChildren<=i.getPlayerCount()&&(this.tempPlayerCount=0),this.gradeIndex+=1,Laya.timer.clear(this,this.checkIsOver),this.gradeIndex>=4){p.instance.recordStop(),this.tempPlayerCount=0,i.getPlayerData().grade+=1,i.getPlayerData().gradeIndex=0,i.setPlayerData(),Laya.Scene.close("MyScenes/GameUI.scene");let t=()=>{i.getPlayerData().grade<=1?Laya.Scene.open("MyScenes/FinishUI.scene",!1):Laya.Scene.open("MyScenes/ShareVideoUI.scene",!1)};return void(e.configData.GQQT_kg&&0==Math.floor((i.getPlayerData().grade-1-e.configData.GQQT_GQKZ)%3)&&i.getPlayerData().grade-1-e.configData.GQQT_GQKZ>=0?(y.instance.closeVCB=t,y.instance.showVideo(()=>{})):t())}i.getPlayerData().gradeIndex=this.gradeIndex,i.setPlayerData(),o.Share.initData(),Laya.timer.once(200,this,()=>{this.moveCamera(w,1800)});let a=(i.getPlayerCount()+this.tempPlayerCount-1)*C/2;for(let e=0;e<this._playerNode.numChildren;e++){let i=this._playerNode.getChildAt(e),s=i.getComponent(u);s.fightStarted=!1;let n=new Laya.Vector3(a-e*C,0,w*this.gradeIndex);t.TmoveTo(i,2e3,n,()=>{s.playIdle2()}),t.RotateTo(i,1e3,new Laya.Vector3(0,0,0),()=>{})}this.createAi(),Laya.timer.once(2e3,this,()=>{this.checkIsNeedCreatePlayer()})}this._playerNode.numChildren<=0&&(this.tempPlayerCount=0,g.Share.visibleGameOverNode(!0))}getIsOver(){if(this._playerNode.numChildren<=0)return!0;{let e=!0;for(let t=0;t<this._playerNode.numChildren;t++){if(!this._playerNode.getChildAt(t).getComponent(u).isDied){e=!1;break}}return e}}checkIsNeedCreatePlayer(){this._playerNode.numChildren<i.getPlayerCount()&&this.gradeIndex<3?(y.instance.hideBanner(),g.Share.reviveBtnCB()):this.readyGo()}revivePlayer(){this.canTouch=!0,this.pushPlayer()}goAhead(){this.readyGo()}upgradePlayerCount(){this._playerNode.destroyChildren(),this.createPlayer()}changePlayerSkin(e){for(let t=0;t<this._playerNode.numChildren;t++){let a=this._playerNode.getChildAt(t).getComponent(u);e?a.changeSkin(e):a.changeSkin(i.getPlayerData().playerId)}}checkCanUpgrade(){let e=i.getPlayerData().coin;0==i.getPlayerData().gradeIndex&&(e>=i.getUpgradePlayerCountLvCost()||e>=i.getUpgradePlayerPowerLvCost()||e>=i.getUpgradeOfflineLvCost())&&g.Share.upgradeBtnCB()}restartGame(){this.gameStarted=!1,0==i.getPlayerData().gradeIndex&&(this._camera.transform.position=this.camStartPos,this.isHelpStart||(this.getCoinNum=0,this.canReady=!1,-1!=i.freeSkinId&&(i.freeSkinId=-1))),this._aiNode.destroyChildren(),this._playerNode.destroyChildren(),this.createAi(),this.createPlayer(),g.Share.visibleBottomUI(!0),this.canTouch=!0,o.Share.initData(),this.checkCanUpgrade()}}f.WEAPON_LENGTH_MAX=100,f.WEAPON_LENGTH_MIN=10;class v extends Laya.Scene{constructor(){super(),this.backBtn=this.backBtn,this.coinNum=this.coinNum,this.skinIcon=this.skinIcon,this.boxNode=this.boxNode,this.keyNode=this.keyNode,this.videoBtn=this.videoBtn,this.keyNum=3,this.clickCount=0,this.skinId=-1,this.skinIndex=-1,this.gotBounes=!1}onOpened(e){this.backBtn.on(Laya.Event.CLICK,this,this.backBtnCB),this.videoBtn.on(Laya.Event.CLICK,this,this.videoBtnCB),this.initKey(),this.initCoin(),this.getBoxSkinId();for(let e=0;e<this.boxNode.numChildren;e++){let t=this.boxNode.getChildAt(e);t.on(Laya.Event.CLICK,this,this.itemCB,[e]),t.getChildByName("coinNode").visible=!1}}onClosed(){}getBoxSkinId(){let e=i.getBoxSkins();if(e.length<=0)return this.skinId=-1,void(this.skinIcon.skin="mainUI/sy-jb.png");this.skinIndex=Math.floor(Math.random()*e.length),this.skinId=e[this.skinIndex],-1==this.skinId?this.skinIcon.skin="mainUI/sy-jb.png":this.skinIcon.skin=i.getHeroSkinDir(this.skinId)}initKey(){for(let e=0;e<3;e++){this.keyNode.getChildAt(e).skin=e<this.keyNum?"boxUI/bx-ys1.png":"boxUI/bx-ys2.png"}}initCoin(){this.coinNum.value=i.getPlayerData().coin.toString()}itemCB(e){let t=this.boxNode.getChildAt(e),a=t.getChildByName("box"),n=t.getChildByName("coinNode"),r=n.getChildByName("coinNum");if("boxUI/bx-di2.png"==t.skin||this.keyNum<=0)return;t.skin="boxUI/bx-di2.png",this.keyNum--,this.clickCount++,this.initKey(),this.clickCount>=9?(this.keyNode.visible=!1,this.videoBtn.visible=!1):this.keyNum<=0&&(this.keyNode.visible=!1,this.videoBtn.visible=!0);let o=!1,h=5,l=100*Math.random();l<=20||(l<=35?h=10:l<=45?h=15:l<=55?h=20:l<=65?h=25:l<=75?h=30:l<=85?h=35:l<=95?h=50:-1==this.skinId||this.gotBounes?(o=!1,h=50):(this.gotBounes=!0,o=!0)),this.clickCount>=9&&-1!=this.skinId&&!this.gotBounes&&(this.gotBounes=!0,o=!0),o?(i.getPlayerSkin(i.skinArr3.indexOf(this.skinId)+18,this.skinId),a.visible=!0,a.skin=i.getHeroSkinDir(this.skinId),a.y=65):(s.instance.playSoundEffect("getCoin.mp3"),i.changeCoin(h),this.initCoin(),a.visible=!1,n.visible=!0,r.value=h.toString())}videoBtnCB(){e.aldEvent("增加三个钥匙：点击");y.instance.showVideo(()=>{e.aldEvent("增加三个钥匙：成功"),this.keyNum=3,this.videoBtn.visible=!1,this.keyNode.visible=!0,this.initKey()})}backBtnCB(){Laya.Scene.open("MyScenes/GameUI.scene",!0,()=>{f.Share.restartGame()})}}class B extends Laya.Script{constructor(){super(),this.shareIconStr="",this.videoIconStr="",this.myOwner=null}onAwake(){this.myOwner=this.owner}onDisable(){}onUpdate(){e.front_share_number>0?this.myOwner.skin=this.shareIconStr:this.myOwner.skin=this.videoIconStr}}class S extends Laya.Script{constructor(){super()}onAwake(){let e=this.owner;e.y=e.y*Laya.stage.displayHeight/1334}}class P extends Laya.Scene{constructor(){super(),this.box=this.box,this.tips=this.tips,this.tick=this.tick,this.sureBtn=this.sureBtn,this.bar=this.bar,this.curProgress=0,this.gotBox=!1}onOpened(){this.initData()}onClosed(){Laya.timer.clearAll(this)}initData(){this.sureBtn.on(Laya.Event.CLICK,this,this.clickBoxBtnCB),this.tips.on(Laya.Event.CLICK,this,this.tickCB),Laya.timer.frameLoop(1,this,this.decProgress)}decProgress(){if(this.curProgress>=1)return Laya.timer.clear(this,this.decProgress),void(this.bar.value=this.curProgress);this.curProgress-=.005,this.curProgress<0&&(this.curProgress=0),this.bar.value=this.curProgress}clickBoxBtnCB(){if(this.gotBox){let e=()=>{this.close(),Laya.Scene.open("MyScenes/GameUI.scene"),f.Share.restartGame()};this.tick.visible?y.instance.showVideo(e):e()}else this.curProgress+=.1,this.curProgress>=1&&(this.gotBox=!0,this.tips.visible=!0,this.tick.visible=!0,this.bar.visible=!1,this.box.skin="clickBoxUI/cj-bx2.png",this.sureBtn.skin="clickBoxUI/cj-an.png",this.sureBtn.getChildAt(0).visible=!1)}tickCB(){this.tick.visible=!this.tick.visible}}class I extends Laya.Scene{constructor(){super(),this.heroSkin=this.heroSkin,this.shareBtn=this.shareBtn,this.noBtn=this.noBtn,this.skinId=-1}onOpened(){this.shareBtn.on(Laya.Event.CLICK,this,this.shareBtnCB),this.noBtn.on(Laya.Event.CLICK,this,this.noBtnCB);let e=i.getFreeSkins();this.skinId=t.getRandomItemInArr(e),this.heroSkin.skin="freeSkins/HeroD_"+(this.skinId+1)+".png",t.visibleDelay(this.noBtn,2e3)}onClosed(){}shareBtnCB(){p.instance.shareVideo(()=>{e.ExtractUIGapGrade=3,i.getPlayerSkin(i.getPlayerArrIndexByValue(this.skinId),this.skinId),f.Share.changePlayerSkin(),this.noBtnCB()})}noBtnCB(){this.close()}}class k extends Laya.Scene{constructor(){super(),this.coinPage=this.coinPage,this.boxPage=this.boxPage,this.videoCoinBtn=this.videoCoinBtn,this.noCoinBtn=this.noCoinBtn,this.tgBtn=this.tgBtn,this.videoTG=this.videoTG,this.openBoxBtn=this.openBoxBtn,this.nextBtn=this.nextBtn,this.navNode=this.navNode,this.haveBox=!1,this.randTGNum=4,this.tgCount=0,this.tempRandNum=4,this.isChick=!1,this.isSwitch=!0}onOpened(a){this.getIsChick(),e.aldEvent("第"+i.getPlayerData().grade+"关：通关"),this.initData(),this.tempRandNum=t.GetRandom(1,4),this.randTGNum=this.tempRandNum,this.coinNum.value=this.videoTG.selected?5*f.Share.getCoinNum:f.Share.getCoinNum,y.instance.showBanner(),this.changeCloseLabel(),this.navNode.visible=!e.getIsIos(),this.initNavNode(),localStorage.getItem("weaponGrade")&&localStorage.setItem("weaponGrade",(parseInt(localStorage.getItem("weaponGrade"))+1).toString())}onClosed(){e.showFinishWudian--,y.instance.hideBanner()}initNavNode(){let a=[];for(let e=1;e<=17;e++)a.push(e);a=t.shuffleArr(a);for(let t=0;t<this.navNode.numChildren;t++){let i=this.navNode.getChildAt(t);i.skin="res/icons/icon ("+a[t]+").png",i.on(Laya.Event.CLICK,this,()=>{e.showMoreGamesModal()})}}getIsChick(){i.getPlayerData().grade-1<=2?this.isChick=!1:i.getPlayerData().grade-1==3||i.getPlayerData().grade-1==4?this.isChick=!1:this.isChick=0!=Math.floor((i.getPlayerData().grade-1)%2)}initData(){this.videoCoinBtn.on(Laya.Event.CLICK,this,this.videoCoinBtnCB),this.noCoinBtn.on(Laya.Event.CLICK,this,this.noCoinBtnCB),this.tgBtn.on(Laya.Event.CLICK,this,this.tgBtnCB),this.openBoxBtn.on(Laya.Event.CLICK,this,this.openBoxBtnCB),this.nextBtn.on(Laya.Event.CLICK,this,this.nextBtnCB);let e=i.getPlayerData().grade-1,t=0==Math.floor(e%4)?4:Math.floor(e%4);this.haveBox=4==t,f.Share.isHelpStart=!1,f.Share.gradeIndex=0,i.getPlayerData().gradeIndex=0,i.setPlayerData()}videoCoinBtnCB(t){e.ttEvent("Event_14");let a=()=>{e.ttEvent("Event_15"),i.changeCoin(5*f.Share.getCoinNum),this.closeCoinPage()};t&&(y.instance.closeVCB=a),y.instance.showVideo(a)}noCoinBtnCB(){let t=this.videoTG.selected;if((t=this.isChick?!t:t)&&this.isSwitch){e.ttEvent("Event_14");let t=()=>{e.ttEvent("Event_15"),i.changeCoin(5*f.Share.getCoinNum),this.closeCoinPage()};y.instance.showVideo(t)}else i.changeCoin(f.Share.getCoinNum),this.closeCoinPage()}tgBtnCB(){this.videoTG.selected?(this.tgCount++,this.tgCount>this.randTGNum&&(this.tgCount=0,this.randTGNum=this.tempRandNum,this.videoTG.selected=!1,1==e.configData.give_gold_switch&&i.getPlayerData().grade-1>=e.configData.GXQT_kg&&(3==this.tempRandNum||4==this.tempRandNum)&&(this.videoCoinBtnCB(!0),e.showFinishWudian=2))):this.videoTG.selected=!0,this.changeCloseLabel()}changeCloseLabel(){if(!e.configData.give_gold_switch||i.getPlayerData().grade-1<e.configData.GXQT_kg)return this.isSwitch=!1,this.coinNum.value=f.Share.getCoinNum,this.noCoinBtn.skin="TTRes/dy-sm3.png",void(this.tgBtn.visible=!1);this.isChick?(this.coinNum.value=this.videoTG.selected?f.Share.getCoinNum:5*f.Share.getCoinNum,this.noCoinBtn.skin=this.videoTG.selected?"TTRes/dy-sm3.png":"TTRes/dy-sm.png",this.tgTips.skin=this.videoTG.selected?"TTRes/dy-wz4.png":"TTRes/dy-wz2.png"):(this.coinNum.value=this.videoTG.selected?5*f.Share.getCoinNum:f.Share.getCoinNum,this.noCoinBtn.skin=this.videoTG.selected?"TTRes/dy-sm.png":"TTRes/dy-sm3.png",this.tgTips.skin=this.videoTG.selected?"TTRes/dy-wz2.png":"TTRes/dy-wz4.png")}closeCoinPage(){this.haveBox?(this.coinPage.visible=!1,this.boxPage.visible=!0):e.configData.front_box_wudian_switch?Laya.Scene.open("MyScenes/ClickBoxUI.scene"):(Laya.Scene.open("MyScenes/GameUI.scene"),f.Share.restartGame())}openBoxBtnCB(){e.ttEvent("Event_16");y.instance.showVideo(()=>{e.ttEvent("Event_17"),Laya.Scene.open("MyScenes/BoxUI.scene")})}nextBtnCB(){Laya.Scene.open("MyScenes/GameUI.scene"),f.Share.restartGame()}}class b extends Laya.Scene{constructor(){super(),this.tipsPic=this.tipsPic,this.weaponPic=this.weaponPic,this.weaponName=this.weaponName,this.info=this.info,this.sureBtn=this.sureBtn}onOpened(e){this.sureBtn.on(Laya.Event.CLICK,this,this.sureBtnCB),this.weaponPic.skin="weaponRes/sq_wq"+(e+1)+".png",this.tipsPic.skin="weaponRes/sq_tx"+(e+1)+".png",this.weaponName.text=i.getWeaponDataById(e).name,this.info.text=i.getWeaponDataById(e).info}onClosed(){}sureBtnCB(){this.close()}}class D extends Laya.Scene{constructor(){super(),this.closeBtn=this.closeBtn,this.itemNode=this.itemNode,this.randBtn=this.randBtn,this.videoTG=this.videoTG,this.tgBtn=this.tgBtn,this.skinArr=[],this.randTGNum=3,this.tgCount=0,this.tempRandNum=3,this.isChick=!1,this.isSwitch=!0}onOpened(e){this.closeBtn.on(Laya.Event.CLICK,this,this.closeBtnCB),this.randBtn.on(Laya.Event.CLICK,this,this.randBtnCB),this.tgBtn.on(Laya.Event.CLICK,this,this.toggleCB),this.skinArr=i.getFreeSkins(),this.tempRandNum=t.GetRandom(1,3),this.randTGNum=this.tempRandNum,this.getIsChick(),this.initData(),y.instance.showBanner(),this.changeCloseLabel()}onClosed(){p.instance.recordResume(),y.instance.hideBanner()}getIsChick(){i.getPlayerData().grade<=2?this.isChick=!1:3==i.getPlayerData().grade||4==i.getPlayerData().grade?this.isChick=!0:this.isChick=0==Math.floor(i.getPlayerData().grade%2)}initData(){this.icon.skin="freeSkins/HeroD_"+(this.skinArr[0]+1)+".png"}itemCB(e){i.freeSkinId=e,f.Share.changePlayerSkin(e)}randBtnCB(){e.ttEvent("Event_10");y.instance.showVideo(()=>{e.ttEvent("Event_11");let a=t.getRandomItemInArr(this.skinArr);this.itemCB(a),this.closeCB()})}closeBtnCB(){let e=this.videoTG.selected;(e=this.isChick?!e:e)&&this.isSwitch?this.randBtnCB():this.closeCB()}closeCB(){Laya.Scene.close("MyScenes/FreeSkinUI.scene"),f.Share.canReady=!0,f.Share.readyGo()}toggleCB(){this.videoTG.selected?(this.tgCount++,this.tgCount>this.randTGNum&&(this.tgCount=0,this.randTGNum=this.tempRandNum,this.videoTG.selected=!1)):this.videoTG.selected=!0,this.changeCloseLabel()}changeCloseLabel(){if(!e.configData.give_gold_switch||i.getPlayerData().grade<e.configData.GXQT_kg)return this.closeBtn.skin="TTRes/dy-sm2.png",this.tgBtn.visible=!1,this.videoTG.visible=!1,void(this.isSwitch=!1);this.isChick?(this.closeBtn.skin=this.videoTG.selected?"TTRes/dy-sm2.png":"TTRes/dy-sm4.png",this.tgTips.skin=this.videoTG.selected?"TTRes/dy-wz4.png":"TTRes/dy-wz.png"):(this.closeBtn.skin=this.videoTG.selected?"TTRes/dy-sm4.png":"TTRes/dy-sm2.png",this.tgTips.skin=this.videoTG.selected?"TTRes/dy-wz.png":"TTRes/dy-wz4.png")}}class N extends Laya.Scene{constructor(){super(),this.perNum=this.perNum,this.bar=this.bar}onOpened(t){e.ttEvent("Event_1"),s.instance.initLoading(()=>{this.loadRes()})}onClosed(){}loadRes(){var t=[e.UnityPath+"line.lh",e.UnityPath+"Hero_1.lh",e.UnityPath+"Hero_Boss.lh",e.UnityPath+"Circle_1.lh",e.UnityPath+"hitFX.lh"];for(let a=0;a<7;a++)t.push(e.UnityPath+"Arms_"+(a+1)+".lh");for(let a=0;a<9;a++)t.push(e.UnityPath+"H_Arms_"+(a+1)+".lh");for(let a=0;a<10;a++)t.push(e.UnityPath+"Hero"+(a+1)+"_Emb.lh");Laya.loader.create(t,Laya.Handler.create(this,this.onComplete),Laya.Handler.create(this,this.onProgress))}onComplete(){console.log("加载完成"),f.Share.initScene(),Laya.timer.once(1e3,this,()=>{Laya.Scene.open("MyScenes/GameUI.scene",!0,()=>{e.ttEvent("Event_2"),f.Share.createPlayer(),f.Share.createAi()})})}onProgress(e){this.perNum.text=Math.floor(100*e)+"%",this.bar.width=560*e}}class x extends Laya.Scene{constructor(){super(),this.coinNum=this.coinNum,this.noBtn=this.noBtn,this.trippleBtn=this.trippleBtn,this.toggleBtn=this.toggleBtn,this.point=this.point,this.exTimeMin=0,this.bounesNum=0,this.bounesNumTriple=0,this.isTripple=!0,this.updateCompleted=!0}onOpened(e){this.toggleBtn.on(Laya.Event.CLICK,this,this.trippleBtnCB),this.trippleBtn.on(Laya.Event.CLICK,this,this.getBounesCB),this.noBtn.on(Laya.Event.CLICK,this,this.getBounesCB),this.exTimeMin=e,this.bounesNum=i.getPlayerOffline(this.exTimeMin),this.bounesNumTriple=3*this.bounesNum,this.initData(),y.instance.showBanner()}onClosed(){y.instance.hideBanner()}initData(){this.coinNum.value=this.bounesNumTriple.toString(),this.changePoint(),this.changeBtn()}trippleBtnCB(){this.updateCompleted&&(this.updateCompleted=!1,this.isTripple=!this.isTripple,this.changePoint(),this.changeBtn(),t.updateNumber(this.bounesNum,3,this.coinNum,!1,this.isTripple,()=>{this.updateCompleted=!0}))}getBounesCB(){let t=()=>{this.isTripple&&e.ttEvent("Event_19"),i.changeCoin(this.isTripple?this.bounesNumTriple:this.bounesNum),o.Share.initData(),this.close()};this.isTripple?(e.aldEvent("离线收益三倍：点击"),e.ttEvent("Event_18"),y.instance.showVideo(t)):t()}changePoint(){this.point.skin=this.isTripple?"offlineUI/lx-yuan.png":"offlineUI/lx-yuan2.png"}changeBtn(){this.noBtn.visible=!this.isTripple,this.trippleBtn.visible=this.isTripple}}class A extends Laya.Scene{constructor(){super(),this.shareBtn=this.shareBtn,this.shareBtn1=this.shareBtn1,this.shareBtn2=this.shareBtn2,this.closeBtn=this.closeBtn}onOpened(e){e&&e(),this.shareBtn2.on(Laya.Event.CLICK,this,this.shareBtnCB),this.shareBtn1.on(Laya.Event.CLICK,this,this.shareBtnCB),this.shareBtn.on(Laya.Event.CLICK,this,this.shareBtnCB),this.closeBtn.on(Laya.Event.CLICK,this,this.closeBtnCB),t.visibleDelay(this.shareBtn2,1500),t.visibleDelay(this.closeBtn,3e3),y.instance.showBanner()}onClosed(){y.instance.hideBanner()}shareBtnCB(){e.ttEvent("Event_12");p.instance.shareVideo(()=>{e.ttEvent("Event_13"),i.getPlayerData().power+=5,i.getPlayerData().coin+=200,i.setPlayerData(),e.OpenAlert("分享视频成功，获得奖励"),this.closeBtnCB()})}closeBtnCB(){this.close(),Laya.Scene.open("MyScenes/FinishUI.scene",!1)}}class _ extends Laya.Script{constructor(){super(),this.myOwner=null,this._ani=null,this.weaponNode=null,this.embNode=null,this.embScale=null,this.embPos=null,this.embRotation=null}onAwake(){this.myOwner=this.owner,this._ani=this.owner.getComponent(Laya.Animator),this.playIdle1(),this.weaponNode=t.findNodeByName(this.myOwner,"Dummy_Arms"),this.embNode=t.findNodeByName(this.myOwner,"Dummy_Emb");let e=t.findNodeByName(this.myOwner,"Hero1_Emb");this.embScale=e.transform.localScale.clone(),this.embPos=e.transform.localPosition.clone(),this.embRotation=e.transform.localRotation.clone(),this.changeSkin(i.getPlayerData().playerId)}onDisable(){}playIdle1(){this._ani.crossFade("walk",.05),this._ani.crossFade("hit",.05,1)}changeSkin(t){let a=new Laya.UnlitMaterial;Laya.Texture2D.load("res/skinHero/HeroD_"+(t+1)+".png",Laya.Handler.create(this,function(e){a.albedoTexture=e}));for(let e=1;e<=4;e++){this.owner.getChildAt(e).skinnedMeshRenderer.material=a}this.embNode.destroyChildren();let i=Laya.loader.getRes(e.UnityPath+"Hero"+(t+1)+"_Emb.lh"),s=Laya.Sprite3D.instantiate(i,this.embNode,!1,new Laya.Vector3(0,0,0));s.transform.localScale=this.embScale,s.transform.localPosition=this.embPos,s.transform.localRotation=this.embRotation}}class T extends Laya.Scene{constructor(){super(),this.topBar=this.topBar,this.backBtn=this.backBtn,this.coinNum=this.coinNum,this.typePic=this.typePic,this.itemNode=this.itemNode,this.leftBtn=this.leftBtn,this.rightBtn=this.rightBtn,this.pointNode=this.pointNode,this.btn1=this.btn1,this.btn2=this.btn2,this.btn3=this.btn3,this.pageIndex=0,this.scene3D=null,this.light=null,this.camera=null,this.role=null,this.roleCrl=null}onOpened(e){this.backBtn.on(Laya.Event.CLICK,this,this.backBtnCB),this.leftBtn.on(Laya.Event.CLICK,this,this.turnPageCB,[!0]),this.rightBtn.on(Laya.Event.CLICK,this,this.turnPageCB,[!1]),this.leftBtn.visible=!1,this.btn1.on(Laya.Event.CLICK,this,this.btnCB1),this.btn2.on(Laya.Event.CLICK,this,this.btnCB2),this.updateCoinNum(),this.initData(),this.init3DScene()}onClosed(){}init3DScene(){this.scene3D=Laya.stage.addChild(new Laya.Scene3D),this.light=this.scene3D.addChild(new Laya.DirectionLight),this.light.color=new Laya.Vector3(1,.956,.839),this.light.transform.rotate(new Laya.Vector3(59.3,-55.16,0),!0,!1),this.camera=this.scene3D.addChild(new Laya.Camera(0,.1,100)),this.camera.transform.translate(new Laya.Vector3(0,2,7)),this.camera.transform.rotate(new Laya.Vector3(-10,0,0),!0,!1),this.camera.clearFlag=Laya.BaseCamera.CLEARFLAG_DEPTHONLY,this.fixCameraField();let t=Laya.loader.getRes(e.UnityPath+"Hero_1.lh");this.role=Laya.Sprite3D.instantiate(t,this.scene3D,!1,new Laya.Vector3(0,0,0)),this.role.transform.position=new Laya.Vector3(0,2.6,0),this.role.transform.rotationEuler=new Laya.Vector3(0,0,0),this.role.transform.setWorldLossyScale(new Laya.Vector3(.5,.5,.5)),this.roleCrl=this.role.addComponent(_)}fixCameraField(){let e=(Laya.stage.displayHeight-1334<0?0:Laya.stage.displayHeight-1334)/290*10;this.camera.fieldOfView+=e}initData(){this.typePic.skin="skinUI/pf-an"+(this.pageIndex+1)+".png";for(let e=0;e<this.pointNode.numChildren;e++){this.pointNode.getChildAt(e).skin=e==this.pageIndex?"skinUI/pf-yuan2.png":"skinUI/pf-yuan1.png"}this.btn1.getChildAt(0).text=i.getUnlockSkinCost().toString(),this.btn1.visible=0==this.pageIndex,this.btn2.visible=1==this.pageIndex,this.btn3.visible=2==this.pageIndex,this.initItem()}initItem(){for(let e=0;e<this.itemNode.numChildren;e++){let t=this.itemNode.getChildAt(e),a=t.getChildByName("icon"),s=t.getChildByName("tick");t.off(Laya.Event.CLICK,this,this.itemCB);let n=e+9*this.pageIndex,r=i.getPlayerData().playerArr[n]>=0,o=i.skinArr1;switch(this.pageIndex){case 0:o=i.skinArr1;break;case 1:o=i.skinArr2;break;case 2:o=i.skinArr3}e+1<=o.length?(a.visible=r,t.skin=r?"skinUI/pf-di2.png":"skinUI/pf-di.png",r&&(a.skin="heroSkins/Hero_"+(o[e]+1)+".png",t.on(Laya.Event.CLICK,this,this.itemCB,[n])),s.visible=r&&i.getPlayerData().playerId==o[e]):(s.visible=!1,a.visible=!1,t.skin="skinUI/pf-di.png")}}itemCB(e){i.getPlayerData().playerId=i.getPlayerData().playerArr[e],this.roleCrl.changeSkin(i.getPlayerData().playerId),f.Share.changePlayerSkin(),this.initData()}updateCoinNum(){this.coinNum.value=i.getPlayerData().coin.toString(),o.Share.initData()}turnPageCB(e){e?this.pageIndex--:this.pageIndex++,this.leftBtn.visible=this.pageIndex>0,this.rightBtn.visible=this.pageIndex<2,this.initData()}btnCB1(){let a=[].concat(i.getCoinSkins());if(a.length<=0)return void e.OpenAlert("敬请期待！");e.aldEvent("皮肤界面：金币解锁");let s=i.getUnlockSkinCost();if(s>i.getPlayerData().coin)return void e.OpenAlert("金币不足！");e.aldEvent("皮肤界面：金币解锁成功"),i.getPlayerData().unlockSkinCount++,i.changeCoin(-s),this.updateCoinNum();let n=t.getRandomItemInArr(a),r=i.skinArr1.indexOf(n);i.getPlayerSkin(r,n),this.roleCrl.changeSkin(i.getPlayerData().playerId),f.Share.changePlayerSkin(),this.initData()}btnCB2(){let a=[].concat(i.getVideoSkins());if(console.log(a),a.length<=0)return void e.OpenAlert("敬请期待！");e.aldEvent("皮肤界面：视频/分享解锁");y.instance.showVideo(()=>{e.aldEvent("皮肤界面：视频/分享解锁成功");let s=t.getRandomItemInArr(a),n=i.skinArr2.indexOf(s)+9;i.getPlayerSkin(n,s),this.roleCrl.changeSkin(i.getPlayerData().playerId),f.Share.changePlayerSkin(),this.initData()})}backBtnCB(){this.scene3D.destroy(),this.close()}}class E extends Laya.Scene{constructor(){super(),this.closeBtn=this.closeBtn,this.gotNum=this.gotNum,this.weaponName=this.weaponName,this.weaponPic=this.weaponPic,this.tipsPic=this.tipsPic,this.info=this.info,this.leftBtn=this.leftBtn,this.rightBtn=this.rightBtn,this.pointNode=this.pointNode,this.tipsBg=this.tipsBg,this.findBtn=this.findBtn,this.lightAni=this.lightAni,this.curPage=0}onOpened(){this.closeBtn.on(Laya.Event.CLICK,this,this.closeBtnCB),this.leftBtn.on(Laya.Event.CLICK,this,this.turnPageBtnCB,[!0]),this.rightBtn.on(Laya.Event.CLICK,this,this.turnPageBtnCB,[!1]),this.findBtn.on(Laya.Event.CLICK,this,this.findBtnCB),this.initWeaponData(this.curPage)}onClosed(){}turnPageBtnCB(e){e?this.curPage--:this.curPage++,this.initWeaponData(this.curPage)}initWeaponData(e){this.weaponPic.skin="weaponRes/sq_wq"+(e+1)+".png",this.tipsPic.skin="weaponRes/sq_tx"+(e+1)+".png",this.weaponName.text=i.getWeaponDataById(e).name,this.info.text=i.getWeaponDataById(e).info,this.leftBtn.visible=this.curPage>0,this.rightBtn.visible=this.curPage<8;for(let t=0;t<this.pointNode.numChildren;t++){this.pointNode.getChildAt(t).skin="weaponRes/sq_yd"+(t==e?"2":"1")+".png"}localStorage.getItem("weapon"+e)?(this.tipsBg.visible=!0,this.info.visible=!0,this.findBtn.visible=!1,this.lightAni.y=342,this.weaponPic.y=342,this.weaponPic.scale(.5,.5)):(this.weaponName.text="通关"+(2*e-parseInt(localStorage.getItem("weaponGrade")))+"个关卡后解锁",this.weaponPic.skin="weaponRes/sq_wh.png",this.tipsBg.visible=!1,this.info.visible=!1,this.findBtn.visible=!0,this.lightAni.y=300,this.weaponPic.y=300,this.weaponPic.scale(1,1));let t=0;for(let e=0;e<9;e++)localStorage.getItem("weapon"+e)&&t++;this.gotNum.text=t.toString()+"/9"}findBtnCB(){y.instance.showVideo(()=>{localStorage.setItem("weapon"+this.curPage,"1"),g.Share.refreshArr.push(this.curPage),g.Share.refreshWeaponTips(),this.initWeaponData(this.curPage)})}closeBtnCB(){this.close()}}class U{constructor(){}static init(){var e=Laya.ClassUtils.regClass;e("View/BoxUI.ts",v),e("Libs/FixAdShareIcon.ts",B),e("Libs/FixNodeY.ts",S),e("View/ClickBoxUI.ts",P),e("View/ExtractUI.ts",I),e("View/FinishUI.ts",k),e("View/FoundWeaponUI.ts",b),e("View/FreeSkinUI.ts",D),e("View/GameUI.ts",g),e("View/GameTopNode.ts",o),e("View/LoadingUI.ts",N),e("View/OfflineUI.ts",x),e("View/ShareVideoUI.ts",A),e("View/SkinUI.ts",T),e("View/WeaponDicUI.ts",E),e("Crl/FixAiTips.ts",c)}}U.width=750,U.height=1334,U.scaleMode="fixedwidth",U.screenMode="vertical",U.alignV="middle",U.alignH="center",U.startScene="MyScenes/LoadingUI.scene",U.sceneRoot="",U.debug=!1,U.stat=!1,U.physicsDebug=!1,U.exportSceneToJson=!0,U.init();new class{constructor(){window.Laya3D?Laya3D.init(U.width,U.height):Laya.init(U.width,U.height,Laya.WebGL),Laya.Physics&&Laya.Physics.enable(),Laya.DebugPanel&&Laya.DebugPanel.enable(),Laya.stage.scaleMode=U.scaleMode,Laya.stage.screenMode=U.screenMode,Laya.stage.alignV=U.alignV,Laya.stage.alignH=U.alignH,Laya.URL.exportSceneToJson=U.exportSceneToJson,(U.debug||"true"==Laya.Utils.getQueryString("debug"))&&Laya.enableDebugPanel(),U.physicsDebug&&Laya.PhysicsDebugDraw&&Laya.PhysicsDebugDraw.enable(),U.stat&&Laya.Stat.show(),Laya.alertGlobalError(!0),Laya.ResourceVersion.enable("version.json",Laya.Handler.create(this,this.onVersionLoaded),Laya.ResourceVersion.FILENAME_VERSION)}onVersionLoaded(){Laya.AtlasInfoManager.enable("fileconfig.json",Laya.Handler.create(this,this.onConfigLoaded))}onConfigLoaded(){new f}}}();