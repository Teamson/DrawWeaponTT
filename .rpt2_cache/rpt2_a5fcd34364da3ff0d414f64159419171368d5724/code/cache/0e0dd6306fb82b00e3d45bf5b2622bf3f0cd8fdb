{
  "code": "import PlayerDataMgr from \"../Libs/PlayerDataMgr\";\r\nimport WxApi from \"../Libs/WxApi\";\r\nimport SkinUIPlayer from \"../Crl/SkinUIPlayer\";\r\nimport GameLogic from \"../Crl/GameLogic\";\r\nimport Utility from \"../Mod/Utility\";\r\nimport GameTopNode from \"./GameTopNode\";\r\nimport AdMgr from \"../Mod/AdMgr\";\r\nexport default class SkinUI extends Laya.Scene {\r\n    constructor() {\r\n        super();\r\n        this.topBar = this['topBar'];\r\n        this.backBtn = this['backBtn'];\r\n        this.coinNum = this['coinNum'];\r\n        this.typePic = this['typePic'];\r\n        this.itemNode = this['itemNode'];\r\n        this.leftBtn = this['leftBtn'];\r\n        this.rightBtn = this['rightBtn'];\r\n        this.pointNode = this['pointNode'];\r\n        this.btn1 = this['btn1'];\r\n        this.btn2 = this['btn2'];\r\n        this.btn3 = this['btn3'];\r\n        this.pageIndex = 0;\r\n        this.scene3D = null;\r\n        this.light = null;\r\n        this.camera = null;\r\n        this.role = null;\r\n        this.roleCrl = null;\r\n    }\r\n    onOpened(param) {\r\n        this.backBtn.on(Laya.Event.CLICK, this, this.backBtnCB);\r\n        this.leftBtn.on(Laya.Event.CLICK, this, this.turnPageCB, [true]);\r\n        this.rightBtn.on(Laya.Event.CLICK, this, this.turnPageCB, [false]);\r\n        this.leftBtn.visible = false;\r\n        this.btn1.on(Laya.Event.CLICK, this, this.btnCB1);\r\n        this.btn2.on(Laya.Event.CLICK, this, this.btnCB2);\r\n        this.updateCoinNum();\r\n        this.initData();\r\n        this.init3DScene();\r\n    }\r\n    onClosed() {\r\n    }\r\n    init3DScene() {\r\n        this.scene3D = Laya.stage.addChild(new Laya.Scene3D());\r\n        this.light = this.scene3D.addChild(new Laya.DirectionLight());\r\n        this.light.color = new Laya.Vector3(1, 0.956, 0.839);\r\n        this.light.transform.rotate(new Laya.Vector3(59.3, -55.16, 0), true, false);\r\n        this.camera = this.scene3D.addChild(new Laya.Camera(0, 0.1, 100));\r\n        this.camera.transform.translate(new Laya.Vector3(0, 2, 7));\r\n        this.camera.transform.rotate(new Laya.Vector3(-10, 0, 0), true, false);\r\n        this.camera.clearFlag = Laya.BaseCamera.CLEARFLAG_DEPTHONLY;\r\n        this.fixCameraField();\r\n        let playerRes = Laya.loader.getRes(WxApi.UnityPath + 'Hero_1.lh');\r\n        this.role = Laya.Sprite3D.instantiate(playerRes, this.scene3D, false, new Laya.Vector3(0, 0, 0));\r\n        this.role.transform.position = new Laya.Vector3(0, 2.6, 0);\r\n        this.role.transform.rotationEuler = new Laya.Vector3(0, 0, 0);\r\n        this.role.transform.setWorldLossyScale(new Laya.Vector3(0.5, 0.5, 0.5));\r\n        this.roleCrl = this.role.addComponent(SkinUIPlayer);\r\n    }\r\n    fixCameraField() {\r\n        let staticDT = 1624 - 1334;\r\n        let curDT = Laya.stage.displayHeight - 1334 < 0 ? 0 : Laya.stage.displayHeight - 1334;\r\n        let per = curDT / staticDT * 10;\r\n        this.camera.fieldOfView += per;\r\n    }\r\n    initData() {\r\n        this.typePic.skin = 'skinUI/pf-an' + (this.pageIndex + 1) + '.png';\r\n        for (let i = 0; i < this.pointNode.numChildren; i++) {\r\n            let p = this.pointNode.getChildAt(i);\r\n            p.skin = i == this.pageIndex ? 'skinUI/pf-yuan2.png' : 'skinUI/pf-yuan1.png';\r\n        }\r\n        let coinNum = this.btn1.getChildAt(0);\r\n        coinNum.text = PlayerDataMgr.getUnlockSkinCost().toString();\r\n        this.btn1.visible = this.pageIndex == 0;\r\n        this.btn2.visible = this.pageIndex == 1;\r\n        this.btn3.visible = this.pageIndex == 2;\r\n        this.initItem();\r\n    }\r\n    initItem() {\r\n        for (let i = 0; i < this.itemNode.numChildren; i++) {\r\n            let item = this.itemNode.getChildAt(i);\r\n            let icon = item.getChildByName('icon');\r\n            let tick = item.getChildByName('tick');\r\n            item.off(Laya.Event.CLICK, this, this.itemCB);\r\n            let index = i + this.pageIndex * 9;\r\n            let isHave = PlayerDataMgr.getPlayerData().playerArr[index] >= 0;\r\n            let skinArr = PlayerDataMgr.skinArr1;\r\n            switch (this.pageIndex) {\r\n                case 0:\r\n                    skinArr = PlayerDataMgr.skinArr1;\r\n                    break;\r\n                case 1:\r\n                    skinArr = PlayerDataMgr.skinArr2;\r\n                    break;\r\n                case 2:\r\n                    skinArr = PlayerDataMgr.skinArr3;\r\n                    break;\r\n            }\r\n            if (i + 1 <= skinArr.length) {\r\n                icon.visible = isHave;\r\n                item.skin = isHave ? 'skinUI/pf-di2.png' : 'skinUI/pf-di.png';\r\n                if (isHave) {\r\n                    icon.skin = 'heroSkins/Hero_' + (skinArr[i] + 1) + '.png';\r\n                    item.on(Laya.Event.CLICK, this, this.itemCB, [index]);\r\n                }\r\n                tick.visible = isHave && PlayerDataMgr.getPlayerData().playerId == skinArr[i];\r\n            }\r\n            else {\r\n                tick.visible = false;\r\n                icon.visible = false;\r\n                item.skin = 'skinUI/pf-di.png';\r\n            }\r\n        }\r\n    }\r\n    itemCB(id) {\r\n        PlayerDataMgr.getPlayerData().playerId = PlayerDataMgr.getPlayerData().playerArr[id];\r\n        this.roleCrl.changeSkin(PlayerDataMgr.getPlayerData().playerId);\r\n        GameLogic.Share.changePlayerSkin();\r\n        this.initData();\r\n    }\r\n    updateCoinNum() {\r\n        this.coinNum.value = PlayerDataMgr.getPlayerData().coin.toString();\r\n        GameTopNode.Share.initData();\r\n    }\r\n    turnPageCB(isLeft) {\r\n        if (isLeft) {\r\n            this.pageIndex--;\r\n        }\r\n        else {\r\n            this.pageIndex++;\r\n        }\r\n        this.leftBtn.visible = this.pageIndex > 0;\r\n        this.rightBtn.visible = this.pageIndex < 2;\r\n        this.initData();\r\n    }\r\n    btnCB1() {\r\n        let skinArr = [].concat(PlayerDataMgr.getCoinSkins());\r\n        if (skinArr.length <= 0) {\r\n            WxApi.OpenAlert('敬请期待！');\r\n            return;\r\n        }\r\n        WxApi.aldEvent('皮肤界面：金币解锁');\r\n        let cost = PlayerDataMgr.getUnlockSkinCost();\r\n        if (cost > PlayerDataMgr.getPlayerData().coin) {\r\n            WxApi.OpenAlert('金币不足！');\r\n            return;\r\n        }\r\n        WxApi.aldEvent('皮肤界面：金币解锁成功');\r\n        PlayerDataMgr.getPlayerData().unlockSkinCount++;\r\n        PlayerDataMgr.changeCoin(-cost);\r\n        this.updateCoinNum();\r\n        let value = Utility.getRandomItemInArr(skinArr);\r\n        let skinId = PlayerDataMgr.skinArr1.indexOf(value);\r\n        PlayerDataMgr.getPlayerSkin(skinId, value);\r\n        this.roleCrl.changeSkin(PlayerDataMgr.getPlayerData().playerId);\r\n        GameLogic.Share.changePlayerSkin();\r\n        this.initData();\r\n    }\r\n    btnCB2() {\r\n        let skinArr = [].concat(PlayerDataMgr.getVideoSkins());\r\n        console.log(skinArr);\r\n        if (skinArr.length <= 0) {\r\n            WxApi.OpenAlert('敬请期待！');\r\n            return;\r\n        }\r\n        WxApi.aldEvent('皮肤界面：视频/分享解锁');\r\n        let cb = () => {\r\n            WxApi.aldEvent('皮肤界面：视频/分享解锁成功');\r\n            let value = Utility.getRandomItemInArr(skinArr);\r\n            let skinId = PlayerDataMgr.skinArr2.indexOf(value) + 9;\r\n            PlayerDataMgr.getPlayerSkin(skinId, value);\r\n            this.roleCrl.changeSkin(PlayerDataMgr.getPlayerData().playerId);\r\n            GameLogic.Share.changePlayerSkin();\r\n            this.initData();\r\n        };\r\n        AdMgr.instance.showVideo(cb);\r\n    }\r\n    backBtnCB() {\r\n        this.scene3D.destroy();\r\n        this.close();\r\n    }\r\n}\r\n",
  "references": [
    "E:/LayaProjects/DrawWeapon/src/Libs/PlayerDataMgr.ts",
    "E:/LayaProjects/DrawWeapon/src/Libs/WxApi.ts",
    "E:/LayaProjects/DrawWeapon/src/Crl/SkinUIPlayer.ts",
    "E:/LayaProjects/DrawWeapon/src/Crl/GameLogic.ts",
    "E:/LayaProjects/DrawWeapon/src/Mod/Utility.ts",
    "E:/LayaProjects/DrawWeapon/src/View/GameTopNode.ts",
    "E:/LayaProjects/DrawWeapon/src/Mod/ShareMgr.ts",
    "E:/LayaProjects/DrawWeapon/src/Mod/AdMgr.ts"
  ]
}
