{
  "code": "import PlayerDataMgr from \"./PlayerDataMgr\";\r\nexport default class TimeCountMgr {\r\n    constructor() {\r\n        this.tCount = 0;\r\n        TimeCountMgr.Share = this;\r\n        this.init();\r\n    }\r\n    init() {\r\n        if (localStorage.getItem('powerTime')) {\r\n            this.tCount = parseInt(localStorage.getItem('powerTime'));\r\n        }\r\n        else {\r\n            localStorage.setItem('power', '0');\r\n        }\r\n        this.calculateExitTime();\r\n        if (Laya.Browser.onWeiXin) {\r\n            Laya.Browser.window.wx.onShow((para) => {\r\n                this.calculateExitTime();\r\n            });\r\n            Laya.Browser.window.wx.onHide((para) => {\r\n                localStorage.setItem('powerTime', this.tCount.toString());\r\n                localStorage.setItem('exitTime', new Date().getTime().toString());\r\n            });\r\n        }\r\n        Laya.timer.loop(1000, this, this.calculateTime);\r\n    }\r\n    calculateExitTime() {\r\n        let exitTime = 0;\r\n        if (localStorage.getItem('exitTime')) {\r\n            exitTime = new Date().getTime() - parseInt(localStorage.getItem('exitTime'));\r\n        }\r\n        if (exitTime <= 0)\r\n            return;\r\n        exitTime /= 1000;\r\n        let t = Math.floor(exitTime / 600);\r\n        PlayerDataMgr.getPlayerData().power += t;\r\n        if (PlayerDataMgr.getPlayerData().power > 10) {\r\n            PlayerDataMgr.getPlayerData().power = 10;\r\n            PlayerDataMgr.setPlayerData();\r\n        }\r\n    }\r\n    calculateTime() {\r\n        if (this.tCount <= 0) {\r\n            if (PlayerDataMgr.getPlayerData().power < 10) {\r\n                this.tCount = 600;\r\n            }\r\n            else {\r\n                this.tCount = 0;\r\n            }\r\n            return;\r\n        }\r\n        this.tCount--;\r\n        if (this.tCount <= 0) {\r\n            if (PlayerDataMgr.getPlayerData().power < 10) {\r\n                PlayerDataMgr.getPlayerData().power += 1;\r\n                PlayerDataMgr.setPlayerData();\r\n                this.tCount = PlayerDataMgr.getPlayerData().power < 10 ? 600 : 0;\r\n            }\r\n        }\r\n    }\r\n}\r\n",
  "references": [
    "E:/LayaProjects/DrawWeaponTT/src/Libs/PlayerDataMgr.ts"
  ]
}
