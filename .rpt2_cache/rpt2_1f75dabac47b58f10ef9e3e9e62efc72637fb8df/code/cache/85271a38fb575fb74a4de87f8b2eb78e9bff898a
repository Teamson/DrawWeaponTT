{
  "code": "import WxApi from \"../Libs/WxApi\";\r\nimport SoundMgr from \"./SoundMgr\";\r\nimport AdMgr from \"./AdMgr\";\r\nexport default class ShareMgr {\r\n    constructor() {\r\n        this.path = '';\r\n        this.picCount = 3;\r\n        this.preT = 0;\r\n        this.shareTips = [\r\n            '请分享到活跃的群！',\r\n            '请分享到不同群！',\r\n            '请分享给好友！',\r\n            '请分享给20人以上的群！'\r\n        ];\r\n    }\r\n    static get instance() {\r\n        if (!this._instance) {\r\n            this._instance = new ShareMgr();\r\n        }\r\n        return this._instance;\r\n    }\r\n    initShare() {\r\n        if (Laya.Browser.onWeiXin) {\r\n            Laya.Browser.window.wx.showShareMenu({\r\n                withShareTicket: true,\r\n            });\r\n            let dir = 'res/share/share.png';\r\n            let content = '我画你杀，谁与争锋';\r\n            Laya.Browser.window.wx.onShareAppMessage(function (res) {\r\n                return {\r\n                    title: content,\r\n                    imageUrl: dir,\r\n                };\r\n            });\r\n            Laya.Browser.window.wx.onShow((para) => {\r\n                SoundMgr.instance.playMusic('bgm.mp3');\r\n                if (WxApi.shareCallback) {\r\n                    let t = new Date().getTime();\r\n                    let diff = t - WxApi.shareTime;\r\n                    if (diff / 1000 >= 3 && !WxApi.firstShare) {\r\n                        WxApi.shareCallback();\r\n                        WxApi.front_share_number--;\r\n                        Laya.Browser.window.wx.showToast({\r\n                            title: '分享成功',\r\n                            icon: 'none',\r\n                            duration: 2000\r\n                        });\r\n                        WxApi.shareCallback = null;\r\n                    }\r\n                    else {\r\n                        WxApi.firstShare = false;\r\n                        Laya.Browser.window.wx.showModal({\r\n                            title: '提示',\r\n                            content: this.shareTips[Math.floor(Math.random() * this.shareTips.length)],\r\n                            confirmText: '重新分享',\r\n                            success(res) {\r\n                                if (res.confirm) {\r\n                                    console.log('用户点击确定');\r\n                                    ShareMgr.instance.shareGame(WxApi.shareCallback);\r\n                                }\r\n                                else if (res.cancel) {\r\n                                    console.log('用户点击取消');\r\n                                }\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n    shareGame(cb) {\r\n        if (WxApi.front_share_number <= 0) {\r\n            AdMgr.instance.showVideo(cb);\r\n            return;\r\n        }\r\n        WxApi.shareCallback = cb;\r\n        if (!Laya.Browser.onWeiXin) {\r\n            cb();\r\n            return;\r\n        }\r\n        WxApi.shareTime = new Date().getTime();\r\n        let dir = 'res/share/share.png';\r\n        let content = '我画你杀，谁与争锋';\r\n        Laya.Browser.window.wx.shareAppMessage({\r\n            title: content,\r\n            imageUrl: dir\r\n        });\r\n    }\r\n}\r\n",
  "references": [
    "E:/LayaProjects/DrawWeapon/src/Libs/WxApi.ts",
    "E:/LayaProjects/DrawWeapon/src/Mod/SoundMgr.ts",
    "E:/LayaProjects/DrawWeapon/src/Mod/AdMgr.ts"
  ]
}
