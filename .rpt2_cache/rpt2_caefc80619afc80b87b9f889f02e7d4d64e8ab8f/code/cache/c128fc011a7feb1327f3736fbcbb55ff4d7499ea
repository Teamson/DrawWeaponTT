{
  "code": "import PlayerDataMgr from \"../Libs/PlayerDataMgr\";\r\nimport GameLogic from \"../Crl/GameLogic\";\r\nimport WxApi from \"../Libs/WxApi\";\r\nimport AdMgr from \"../Mod/AdMgr\";\r\nimport Utility from \"../Mod/Utility\";\r\nexport default class FinishUI extends Laya.Scene {\r\n    constructor() {\r\n        super();\r\n        this.coinPage = this['coinPage'];\r\n        this.boxPage = this['boxPage'];\r\n        this.videoCoinBtn = this['videoCoinBtn'];\r\n        this.noCoinBtn = this['noCoinBtn'];\r\n        this.tgBtn = this['tgBtn'];\r\n        this.videoTG = this['videoTG'];\r\n        this.openBoxBtn = this['openBoxBtn'];\r\n        this.nextBtn = this['nextBtn'];\r\n        this.navNode = this['navNode'];\r\n        this.haveBox = false;\r\n        this.randTGNum = 4;\r\n        this.tgCount = 0;\r\n        this.tempRandNum = 4;\r\n        this.isChick = false;\r\n        this.isSwitch = true;\r\n    }\r\n    onOpened(param) {\r\n        this.getIsChick();\r\n        WxApi.aldEvent('第' + PlayerDataMgr.getPlayerData().grade + '关：通关');\r\n        this.initData();\r\n        this.tempRandNum = Utility.GetRandom(1, 4);\r\n        this.randTGNum = this.tempRandNum;\r\n        this['coinNum'].value = this.videoTG.selected ? GameLogic.Share.getCoinNum * 5 : GameLogic.Share.getCoinNum;\r\n        AdMgr.instance.showBanner();\r\n        this.changeCloseLabel();\r\n        this.navNode.visible = !WxApi.getIsIos();\r\n        this.initNavNode();\r\n    }\r\n    onClosed() {\r\n        AdMgr.instance.hideBanner();\r\n    }\r\n    initNavNode() {\r\n        let arr = [];\r\n        for (let i = 1; i <= 17; i++) {\r\n            arr.push(i);\r\n        }\r\n        arr = Utility.shuffleArr(arr);\r\n        for (let i = 0; i < this.navNode.numChildren; i++) {\r\n            let item = this.navNode.getChildAt(i);\r\n            item.skin = 'res/icons/icon (' + arr[i] + ').png';\r\n            item.on(Laya.Event.CLICK, this, () => {\r\n                WxApi.showMoreGamesModal();\r\n            });\r\n        }\r\n    }\r\n    getIsChick() {\r\n        if (PlayerDataMgr.getPlayerData().grade - 1 <= 2) {\r\n            this.isChick = false;\r\n        }\r\n        else if (PlayerDataMgr.getPlayerData().grade - 1 == 3 || PlayerDataMgr.getPlayerData().grade - 1 == 4) {\r\n            this.isChick = false;\r\n        }\r\n        else {\r\n            this.isChick = Math.floor((PlayerDataMgr.getPlayerData().grade - 1) % 2) != 0;\r\n        }\r\n    }\r\n    initData() {\r\n        this.videoCoinBtn.on(Laya.Event.CLICK, this, this.videoCoinBtnCB);\r\n        this.noCoinBtn.on(Laya.Event.CLICK, this, this.noCoinBtnCB);\r\n        this.tgBtn.on(Laya.Event.CLICK, this, this.tgBtnCB);\r\n        this.openBoxBtn.on(Laya.Event.CLICK, this, this.openBoxBtnCB);\r\n        this.nextBtn.on(Laya.Event.CLICK, this, this.nextBtnCB);\r\n        let grade = PlayerDataMgr.getPlayerData().grade - 1;\r\n        let g = Math.floor(grade % 4) == 0 ? 4 : Math.floor(grade % 4);\r\n        this.haveBox = g == 4;\r\n        GameLogic.Share.isHelpStart = false;\r\n        GameLogic.Share.gradeIndex = 0;\r\n        PlayerDataMgr.getPlayerData().gradeIndex = 0;\r\n        PlayerDataMgr.setPlayerData();\r\n    }\r\n    videoCoinBtnCB() {\r\n        WxApi.ttEvent('Event_14');\r\n        let cb = () => {\r\n            WxApi.ttEvent('Event_15');\r\n            PlayerDataMgr.changeCoin(GameLogic.Share.getCoinNum * 5);\r\n            this.closeCoinPage();\r\n        };\r\n        AdMgr.instance.showVideo(cb);\r\n    }\r\n    noCoinBtnCB() {\r\n        let isBounes = this.videoTG.selected;\r\n        isBounes = this.isChick ? !isBounes : isBounes;\r\n        if (isBounes && this.isSwitch) {\r\n            WxApi.ttEvent('Event_14');\r\n            let cb = () => {\r\n                WxApi.ttEvent('Event_15');\r\n                PlayerDataMgr.changeCoin(GameLogic.Share.getCoinNum * 5);\r\n                this.closeCoinPage();\r\n            };\r\n            AdMgr.instance.showVideo(cb);\r\n        }\r\n        else {\r\n            PlayerDataMgr.changeCoin(GameLogic.Share.getCoinNum);\r\n            this.closeCoinPage();\r\n        }\r\n    }\r\n    tgBtnCB() {\r\n        if (this.videoTG.selected) {\r\n            this.tgCount++;\r\n            if (this.tgCount > this.randTGNum) {\r\n                this.tgCount = 0;\r\n                this.randTGNum = this.tempRandNum;\r\n                this.videoTG.selected = false;\r\n                if (WxApi.configData.give_gold_switch == true && PlayerDataMgr.getPlayerData().grade - 1 >= WxApi.configData.GXQT_kg &&\r\n                    (this.tempRandNum == 3 || this.tempRandNum == 4)) {\r\n                    this.videoCoinBtnCB();\r\n                }\r\n            }\r\n        }\r\n        else {\r\n            this.videoTG.selected = true;\r\n        }\r\n        this.changeCloseLabel();\r\n    }\r\n    changeCloseLabel() {\r\n        if (!WxApi.configData.give_gold_switch || PlayerDataMgr.getPlayerData().grade - 1 < WxApi.configData.GXQT_kg) {\r\n            this.isSwitch = false;\r\n            this['coinNum'].value = GameLogic.Share.getCoinNum;\r\n            this.noCoinBtn.skin = 'TTRes/dy-sm3.png';\r\n            this.tgBtn.visible = false;\r\n            return;\r\n        }\r\n        if (this.isChick) {\r\n            this['coinNum'].value = this.videoTG.selected ? GameLogic.Share.getCoinNum : GameLogic.Share.getCoinNum * 5;\r\n            this.noCoinBtn.skin = this.videoTG.selected ? 'TTRes/dy-sm3.png' : 'TTRes/dy-sm.png';\r\n            this['tgTips'].skin = this.videoTG.selected ? 'TTRes/dy-wz4.png' : 'TTRes/dy-wz2.png';\r\n        }\r\n        else {\r\n            this['coinNum'].value = this.videoTG.selected ? GameLogic.Share.getCoinNum * 5 : GameLogic.Share.getCoinNum;\r\n            this.noCoinBtn.skin = this.videoTG.selected ? 'TTRes/dy-sm.png' : 'TTRes/dy-sm3.png';\r\n            this['tgTips'].skin = this.videoTG.selected ? 'TTRes/dy-wz2.png' : 'TTRes/dy-wz4.png';\r\n        }\r\n    }\r\n    closeCoinPage() {\r\n        if (this.haveBox) {\r\n            this.coinPage.visible = false;\r\n            this.boxPage.visible = true;\r\n        }\r\n        else {\r\n            if (WxApi.configData.front_box_wudian_switch) {\r\n                Laya.Scene.open('MyScenes/ClickBoxUI.scene');\r\n            }\r\n            else {\r\n                Laya.Scene.open('MyScenes/GameUI.scene');\r\n                GameLogic.Share.restartGame();\r\n            }\r\n        }\r\n    }\r\n    openBoxBtnCB() {\r\n        WxApi.ttEvent('Event_16');\r\n        let cb = () => {\r\n            WxApi.ttEvent('Event_17');\r\n            Laya.Scene.open('MyScenes/BoxUI.scene');\r\n        };\r\n        AdMgr.instance.showVideo(cb);\r\n    }\r\n    nextBtnCB() {\r\n        Laya.Scene.open('MyScenes/GameUI.scene');\r\n        GameLogic.Share.restartGame();\r\n    }\r\n}\r\n",
  "references": [
    "E:/LayaProjects/DrawWeaponTT/src/Libs/PlayerDataMgr.ts",
    "E:/LayaProjects/DrawWeaponTT/src/Crl/GameLogic.ts",
    "E:/LayaProjects/DrawWeaponTT/src/Mod/ShareMgr.ts",
    "E:/LayaProjects/DrawWeaponTT/src/Libs/WxApi.ts",
    "E:/LayaProjects/DrawWeaponTT/src/Mod/AdMgr.ts",
    "E:/LayaProjects/DrawWeaponTT/src/Mod/Utility.ts",
    "E:/LayaProjects/DrawWeaponTT/src/Mod/RecorderMgr.ts"
  ]
}
