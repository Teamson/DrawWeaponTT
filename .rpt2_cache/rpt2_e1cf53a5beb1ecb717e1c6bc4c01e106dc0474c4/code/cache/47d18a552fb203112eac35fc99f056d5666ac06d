{
  "code": "import GameLogic from \"../Crl/GameLogic\";\r\nimport PlayerDataMgr from \"../Libs/PlayerDataMgr\";\r\nexport default class BoxUI extends Laya.Scene {\r\n    constructor() {\r\n        super();\r\n        this.backBtn = this['backBtn'];\r\n        this.coinNum = this['coinNum'];\r\n        this.skinIcon = this['skinIcon'];\r\n        this.boxNode = this['boxNode'];\r\n        this.keyNode = this['keyNode'];\r\n        this.videoBtn = this['videoBtn'];\r\n        this.keyNum = 3;\r\n        this.clickCount = 0;\r\n        this.skinId = -1;\r\n        this.skinIndex = -1;\r\n        this.gotBounes = false;\r\n    }\r\n    onOpened(param) {\r\n        this.backBtn.on(Laya.Event.CLICK, this, this.backBtnCB);\r\n        this.videoBtn.on(Laya.Event.CLICK, this, this.videoBtnCB);\r\n        this.initKey();\r\n        this.initCoin();\r\n        this.getBoxSkinId();\r\n        for (let i = 0; i < this.boxNode.numChildren; i++) {\r\n            let item = this.boxNode.getChildAt(i);\r\n            item.on(Laya.Event.CLICK, this, this.itemCB, [i]);\r\n            let coinNode = item.getChildByName('coinNode');\r\n            coinNode.visible = false;\r\n        }\r\n    }\r\n    onClosed() {\r\n    }\r\n    getBoxSkinId() {\r\n        let arr = PlayerDataMgr.skinArr3;\r\n        if (arr.length <= 0) {\r\n            this.skinId = -1;\r\n            return;\r\n        }\r\n        console.log(arr);\r\n        this.skinIndex = Math.floor(Math.random() * arr.length);\r\n        this.skinId = arr[this.skinIndex];\r\n        console.log(this.skinIndex);\r\n        console.log(this.skinId);\r\n        if (this.skinId == -1) {\r\n            this.skinIcon.visible = false;\r\n        }\r\n        else {\r\n            this.skinIcon.skin = PlayerDataMgr.getHeroSkinDir(this.skinId);\r\n        }\r\n    }\r\n    initKey() {\r\n        for (let i = 0; i < 3; i++) {\r\n            let key = this.keyNode.getChildAt(i);\r\n            key.skin = i < this.keyNum ? 'boxUI/bx-ys1.png' : 'boxUI/bx-ys2.png';\r\n        }\r\n    }\r\n    initCoin() {\r\n        this.coinNum.value = PlayerDataMgr.getPlayerData().coin.toString();\r\n    }\r\n    itemCB(id) {\r\n        let item = this.boxNode.getChildAt(id);\r\n        let box = item.getChildByName('box');\r\n        let coinNode = item.getChildByName('coinNode');\r\n        let coinNum = coinNode.getChildByName('coinNum');\r\n        if (item.skin == 'boxUI/bx-di2.png' || this.keyNum <= 0)\r\n            return;\r\n        item.skin = 'boxUI/bx-di2.png';\r\n        this.keyNum--;\r\n        this.clickCount++;\r\n        this.initKey();\r\n        if (this.clickCount >= 9) {\r\n            this.keyNode.visible = false;\r\n            this.videoBtn.visible = false;\r\n        }\r\n        else if (this.keyNum <= 0) {\r\n            this.keyNode.visible = false;\r\n            this.videoBtn.visible = true;\r\n        }\r\n        let isSkin = false;\r\n        let bounes = 5;\r\n        let randNum = Math.random() * 100;\r\n        if (randNum <= 20) {\r\n        }\r\n        else if (randNum <= 35) {\r\n            bounes = 10;\r\n        }\r\n        else if (randNum <= 45) {\r\n            bounes = 15;\r\n        }\r\n        else if (randNum <= 55) {\r\n            bounes = 20;\r\n        }\r\n        else if (randNum <= 65) {\r\n            bounes = 25;\r\n        }\r\n        else if (randNum <= 75) {\r\n            bounes = 30;\r\n        }\r\n        else if (randNum <= 85) {\r\n            bounes = 35;\r\n        }\r\n        else if (randNum <= 95) {\r\n            bounes = 50;\r\n        }\r\n        else {\r\n            if (this.skinId == -1 || this.gotBounes) {\r\n                isSkin = false;\r\n                bounes = 50;\r\n            }\r\n            else {\r\n                this.gotBounes = true;\r\n                isSkin = true;\r\n            }\r\n        }\r\n        if (this.clickCount >= 9 && this.skinId != -1 && !this.gotBounes) {\r\n            this.gotBounes = true;\r\n            isSkin = true;\r\n        }\r\n        if (isSkin) {\r\n            PlayerDataMgr.getPlayerSkin(this.skinIndex + 18, this.skinId);\r\n            box.visible = true;\r\n            box.skin = PlayerDataMgr.getHeroSkinDir(this.skinId);\r\n            box.y = 65;\r\n        }\r\n        else {\r\n            PlayerDataMgr.changeCoin(bounes);\r\n            this.initCoin();\r\n            box.visible = false;\r\n            coinNode.visible = true;\r\n            coinNum.value = bounes.toString();\r\n        }\r\n    }\r\n    videoBtnCB() {\r\n        this.keyNum = 3;\r\n        this.videoBtn.visible = false;\r\n        this.keyNode.visible = true;\r\n        this.initKey();\r\n    }\r\n    backBtnCB() {\r\n        Laya.Scene.open('MyScenes/GameUI.scene', true, () => { GameLogic.Share.restartGame(); });\r\n    }\r\n}\r\n",
  "references": [
    "E:/LayaProjects/DrawWeapon/src/Crl/GameLogic.ts",
    "E:/LayaProjects/DrawWeapon/src/Libs/PlayerDataMgr.ts",
    "E:/LayaProjects/DrawWeapon/src/Mod/Utility.ts"
  ]
}
